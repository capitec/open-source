import{A as ee,B as K,C as pt,D as Pe,E as S,F as Re,G as gt,H as m,I as Ie,J as yt,K as xt,L as St,M as kt,N as Ct,O as $,P as Fe,Q as bt,S as te,U as At,V as ne,W as J,X as We,Y as Ve,a as Y,ba as Mt,fa as vt,ga as Lt,ha as Bt,ia as V,k as Oe,l as O,m as ct,ma as Dt,n as at,na as Et,o as ht,oa as wt,p as ut,pa as Ot,q as ft,r as u,s as q,t as z,u as dt,v as mt,w as Te,x as T,y as Z,z as x}from"./chunk.63SH7AJG.js";import{a as Tt,b as U,d as Ue}from"./chunk.CHYIO324.js";import{a as it,b as lt,g as st}from"./chunk.3GEUDTAZ.js";import{j as L,l as B,o as D}from"./chunk.2ZZQBHAA.js";B();D();B();D();var In=t=>{let e=$e(t.state);return e.line?Fn(t):e.block?Vn(t):!1};function Ke(t,e){return({state:r,dispatch:n})=>{if(r.readOnly)return!1;let o=t(e,r);return o?(n(r.update(o)),!0):!1}}var Fn=Ke(Nn,0);var Wn=Ke(qt,0);var Vn=Ke((t,e)=>qt(t,e,qn(e)),0);function $e(t,e=t.selection.main.head){let r=t.languageDataAt("commentTokens",e);return r.length?r[0]:{}}var H=50;function Un(t,{open:e,close:r},n,o){let i=t.sliceDoc(n-H,n),l=t.sliceDoc(o,o+H),s=/\s*$/.exec(i)[0].length,c=/^\s*/.exec(l)[0].length,a=i.length-s;if(i.slice(a-e.length,a)==e&&l.slice(c,c+r.length)==r)return{open:{pos:n-s,margin:s&&1},close:{pos:o+c,margin:c&&1}};let h,f;o-n<=2*H?h=f=t.sliceDoc(n,o):(h=t.sliceDoc(n,n+H),f=t.sliceDoc(o-H,o));let d=/^\s*/.exec(h)[0].length,W=/\s*$/.exec(f)[0].length,w=f.length-W-r.length;return h.slice(d,d+e.length)==e&&f.slice(w,w+r.length)==r?{open:{pos:n+d+e.length,margin:/\s/.test(h.charAt(d+e.length))?1:0},close:{pos:o-W-r.length,margin:/\s/.test(f.charAt(w-1))?1:0}}:null}function qn(t){let e=[];for(let r of t.selection.ranges){let n=t.doc.lineAt(r.from),o=r.to<=n.to?n:t.doc.lineAt(r.to),i=e.length-1;i>=0&&e[i].to>n.from?e[i].to=o.to:e.push({from:n.from,to:o.to})}return e}function qt(t,e,r=e.selection.ranges){let n=r.map(i=>$e(e,i.from).block);if(!n.every(i=>i))return null;let o=r.map((i,l)=>Un(e,n[l],i.from,i.to));if(t!=2&&!o.every(i=>i))return{changes:e.changes(r.map((i,l)=>o[l]?[]:[{from:i.from,insert:n[l].open+" "},{from:i.to,insert:" "+n[l].close}]))};if(t!=1&&o.some(i=>i)){let i=[];for(let l=0,s;l<o.length;l++)if(s=o[l]){let c=n[l],{open:a,close:h}=s;i.push({from:a.pos-c.open.length,to:a.pos+a.margin},{from:h.pos-h.margin,to:h.pos+c.close.length})}return{changes:i}}return null}function Nn(t,e,r=e.selection.ranges){let n=[],o=-1;for(let{from:i,to:l}of r){let s=n.length,c=1e9;for(let a=i;a<=l;){let h=e.doc.lineAt(a);if(h.from>o&&(i==l||l>h.from)){o=h.from;let f=$e(e,a).line;if(!f)continue;let d=/^\s*/.exec(h.text)[0].length,W=d==h.length,w=h.text.slice(d,d+f.length)==f?d:-1;d<h.text.length&&d<c&&(c=d),n.push({line:h,comment:w,token:f,indent:d,empty:W,single:!1})}a=h.to+1}if(c<1e9)for(let a=s;a<n.length;a++)n[a].indent<n[a].line.text.length&&(n[a].indent=c);n.length==s+1&&(n[s].single=!0)}if(t!=2&&n.some(i=>i.comment<0&&(!i.empty||i.single))){let i=[];for(let{line:s,token:c,indent:a,empty:h,single:f}of n)(f||!h)&&i.push({from:s.from+a,insert:c+" "});let l=e.changes(i);return{changes:l,selection:e.selection.map(l,1)}}else if(t!=1&&n.some(i=>i.comment>=0)){let i=[];for(let{line:l,comment:s,token:c}of n)if(s>=0){let a=l.from+s,h=a+c.length;l.text[h-l.from]==" "&&h++,i.push({from:a,to:h})}return{changes:i}}return null}var Ne=Te.define(),_n=Te.define(),Gn=q.define(),Nt=q.define({combine(t){return K(t,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})}});function zn(t){let e=0;return t.iterChangedRanges((r,n)=>e=n),e}var _t=z.define({create(){return b.empty},update(t,e){let r=e.state.facet(Nt),n=e.annotation(Ne);if(n){let c=e.docChanged?u.single(zn(e.changes)):void 0,a=g.fromTransaction(e,c),h=n.side,f=h==0?t.undone:t.done;return a?f=oe(f,f.length,r.minDepth,a):f=$t(f,e.startState.selection),new b(h==0?n.rest:f,h==0?f:n.rest)}let o=e.annotation(_n);if((o=="full"||o=="before")&&(t=t.isolate()),e.annotation(Z.addToHistory)===!1)return e.changes.empty?t:t.addMapping(e.changes.desc);let i=g.fromTransaction(e),l=e.annotation(Z.time),s=e.annotation(Z.userEvent);return i?t=t.addChanges(i,l,s,r.newGroupDelay,r.minDepth):e.selection&&(t=t.addSelection(e.startState.selection,l,s,r.newGroupDelay)),(o=="full"||o=="after")&&(t=t.isolate()),t},toJSON(t){return{done:t.done.map(e=>e.toJSON()),undone:t.undone.map(e=>e.toJSON())}},fromJSON(t){return new b(t.done.map(g.fromJSON),t.undone.map(g.fromJSON))}});function Gt(t={}){return[_t,Nt.of(t),m.domEventHandlers({beforeinput(e,r){let n=e.inputType=="historyUndo"?zt:e.inputType=="historyRedo"?_e:null;return n?(e.preventDefault(),n(r)):!1}})]}function me(t,e){return function({state:r,dispatch:n}){if(!e&&r.readOnly)return!1;let o=r.field(_t,!1);if(!o)return!1;let i=o.pop(t,r,e);return i?(n(i),!0):!1}}var zt=me(0,!1),_e=me(1,!1),Kn=me(0,!0),$n=me(1,!0);var g=class{constructor(e,r,n,o,i){this.changes=e,this.effects=r,this.mapped=n,this.startSelection=o,this.selectionsAfter=i}setSelAfter(e){return new g(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,r,n;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(r=this.mapped)===null||r===void 0?void 0:r.toJSON(),startSelection:(n=this.startSelection)===null||n===void 0?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map(o=>o.toJSON())}}static fromJSON(e){return new g(e.changes&&ft.fromJSON(e.changes),[],e.mapped&&ut.fromJSON(e.mapped),e.startSelection&&u.fromJSON(e.startSelection),e.selectionsAfter.map(u.fromJSON))}static fromTransaction(e,r){let n=C;for(let o of e.startState.facet(Gn)){let i=o(e);i.length&&(n=n.concat(i))}return!n.length&&e.changes.empty?null:new g(e.changes.invert(e.startState.doc),n,void 0,r||e.startState.selection,C)}static selection(e){return new g(void 0,C,void 0,void 0,e)}};function oe(t,e,r,n){let o=e+1>r+20?e-r-1:0,i=t.slice(o,e);return i.push(n),i}function Jn(t,e){let r=[],n=!1;return t.iterChangedRanges((o,i)=>r.push(o,i)),e.iterChangedRanges((o,i,l,s)=>{for(let c=0;c<r.length;){let a=r[c++],h=r[c++];s>=a&&l<=h&&(n=!0)}}),n}function Hn(t,e){return t.ranges.length==e.ranges.length&&t.ranges.filter((r,n)=>r.empty!=e.ranges[n].empty).length===0}function Kt(t,e){return t.length?e.length?t.concat(e):t:e}var C=[],jn=200;function $t(t,e){if(t.length){let r=t[t.length-1],n=r.selectionsAfter.slice(Math.max(0,r.selectionsAfter.length-jn));return n.length&&n[n.length-1].eq(e)?t:(n.push(e),oe(t,t.length-1,1e9,r.setSelAfter(n)))}else return[g.selection([e])]}function Qn(t){let e=t[t.length-1],r=t.slice();return r[t.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),r}function qe(t,e){if(!t.length)return t;let r=t.length,n=C;for(;r;){let o=Xn(t[r-1],e,n);if(o.changes&&!o.changes.empty||o.effects.length){let i=t.slice(0,r);return i[r-1]=o,i}else e=o.mapped,r--,n=o.selectionsAfter}return n.length?[g.selection(n)]:C}function Xn(t,e,r){let n=Kt(t.selectionsAfter.length?t.selectionsAfter.map(s=>s.map(e)):C,r);if(!t.changes)return g.selection(n);let o=t.changes.map(e),i=e.mapDesc(t.changes,!0),l=t.mapped?t.mapped.composeDesc(i):i;return new g(o,T.mapEffects(t.effects,e),l,t.startSelection.map(i),n)}var Yn=/^(input\.type|delete)($|\.)/,b=class{constructor(e,r,n=0,o=void 0){this.done=e,this.undone=r,this.prevTime=n,this.prevUserEvent=o}isolate(){return this.prevTime?new b(this.done,this.undone):this}addChanges(e,r,n,o,i){let l=this.done,s=l[l.length-1];return s&&s.changes&&!s.changes.empty&&e.changes&&(!n||Yn.test(n))&&(!s.selectionsAfter.length&&r-this.prevTime<o&&Jn(s.changes,e.changes)||n=="input.type.compose")?l=oe(l,l.length-1,i,new g(e.changes.compose(s.changes),Kt(e.effects,s.effects),s.mapped,s.startSelection,C)):l=oe(l,l.length,i,e),new b(l,C,r,n)}addSelection(e,r,n,o){let i=this.done.length?this.done[this.done.length-1].selectionsAfter:C;return i.length>0&&r-this.prevTime<o&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&Hn(i[i.length-1],e)?this:new b($t(this.done,e),this.undone,r,n)}addMapping(e){return new b(qe(this.done,e),qe(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,r,n){let o=e==0?this.done:this.undone;if(o.length==0)return null;let i=o[o.length-1];if(n&&i.selectionsAfter.length)return r.update({selection:i.selectionsAfter[i.selectionsAfter.length-1],annotations:Ne.of({side:e,rest:Qn(o)}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(i.changes){let l=o.length==1?C:o.slice(0,o.length-1);return i.mapped&&(l=qe(l,i.mapped)),r.update({changes:i.changes,selection:i.startSelection,effects:i.effects,annotations:Ne.of({side:e,rest:l}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}};b.empty=new b(C,C);var Jt=[{key:"Mod-z",run:zt,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:_e,preventDefault:!0},{linux:"Ctrl-Shift-z",run:_e,preventDefault:!0},{key:"Mod-u",run:Kn,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:$n,preventDefault:!0}];function N(t,e){return u.create(t.ranges.map(e),t.mainIndex)}function E(t,e){return t.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function v({state:t,dispatch:e},r){let n=N(t.selection,r);return n.eq(t.selection)?!1:(e(E(t,n)),!0)}function pe(t,e){return u.cursor(e?t.to:t.from)}function Ht(t,e){return v(t,r=>r.empty?t.moveByChar(r,e):pe(r,e))}function y(t){return t.textDirectionAt(t.state.selection.main.head)==gt.LTR}var jt=t=>Ht(t,!y(t)),Qt=t=>Ht(t,y(t));function Xt(t,e){return v(t,r=>r.empty?t.moveByGroup(r,e):pe(r,e))}var Zn=t=>Xt(t,!y(t)),er=t=>Xt(t,y(t));function tr(t,e,r){if(e.type.prop(r))return!0;let n=e.to-e.from;return n&&(n>2||/[^\s,.;:]/.test(t.sliceDoc(e.from,e.to)))||e.firstChild}function ge(t,e,r){let n=te(t).resolveInner(e.head),o=r?Y.closedBy:Y.openedBy;for(let c=e.head;;){let a=r?n.childAfter(c):n.childBefore(c);if(!a)break;tr(t,a,o)?n=a:c=r?a.to:a.from}let i=n.type.prop(o),l,s;return i&&(l=r?V(t,n.from,1):V(t,n.to,-1))&&l.matched?s=r?l.end.to:l.end.from:s=r?n.to:n.from,u.cursor(s,r?-1:1)}var nr=t=>v(t,e=>ge(t.state,e,!y(t))),rr=t=>v(t,e=>ge(t.state,e,y(t)));function Yt(t,e){return v(t,r=>{if(!r.empty)return pe(r,e);let n=t.moveVertically(r,e);return n.head!=r.head?n:t.moveToLineBoundary(r,e)})}var Zt=t=>Yt(t,!1),en=t=>Yt(t,!0);function tn(t){return Math.max(t.defaultLineHeight,Math.min(t.dom.clientHeight,innerHeight)-5)}function nn(t,e){let{state:r}=t,n=N(r.selection,s=>s.empty?t.moveVertically(s,e,tn(t)):pe(s,e));if(n.eq(r.selection))return!1;let o=t.coordsAtPos(r.selection.main.head),i=t.scrollDOM.getBoundingClientRect(),l;return o&&o.top>i.top&&o.bottom<i.bottom&&o.top-i.top<=t.scrollDOM.scrollHeight-t.scrollDOM.scrollTop-t.scrollDOM.clientHeight&&(l=m.scrollIntoView(n.main.head,{y:"start",yMargin:o.top-i.top})),t.dispatch(E(r,n),{effects:l}),!0}var Pt=t=>nn(t,!1),Ge=t=>nn(t,!0);function P(t,e,r){let n=t.lineBlockAt(e.head),o=t.moveToLineBoundary(e,r);if(o.head==e.head&&o.head!=(r?n.to:n.from)&&(o=t.moveToLineBoundary(e,r,!1)),!r&&o.head==n.from&&n.length){let i=/^\s*/.exec(t.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;i&&e.head!=n.from+i&&(o=u.cursor(n.from+i))}return o}var or=t=>v(t,e=>P(t,e,!0)),ir=t=>v(t,e=>P(t,e,!1)),lr=t=>v(t,e=>P(t,e,!y(t))),sr=t=>v(t,e=>P(t,e,y(t))),cr=t=>v(t,e=>u.cursor(t.lineBlockAt(e.head).from,1)),ar=t=>v(t,e=>u.cursor(t.lineBlockAt(e.head).to,-1));function hr(t,e,r){let n=!1,o=N(t.selection,i=>{let l=V(t,i.head,-1)||V(t,i.head,1)||i.head>0&&V(t,i.head-1,1)||i.head<t.doc.length&&V(t,i.head+1,-1);if(!l||!l.end)return i;n=!0;let s=l.start.from==i.head?l.end.to:l.end.from;return r?u.range(i.anchor,s):u.cursor(s)});return n?(e(E(t,o)),!0):!1}var ur=({state:t,dispatch:e})=>hr(t,e,!1);function A(t,e){let r=N(t.state.selection,n=>{let o=e(n);return u.range(n.anchor,o.head,o.goalColumn)});return r.eq(t.state.selection)?!1:(t.dispatch(E(t.state,r)),!0)}function rn(t,e){return A(t,r=>t.moveByChar(r,e))}var on=t=>rn(t,!y(t)),ln=t=>rn(t,y(t));function sn(t,e){return A(t,r=>t.moveByGroup(r,e))}var fr=t=>sn(t,!y(t)),dr=t=>sn(t,y(t));var mr=t=>A(t,e=>ge(t.state,e,!y(t))),pr=t=>A(t,e=>ge(t.state,e,y(t)));function cn(t,e){return A(t,r=>t.moveVertically(r,e))}var an=t=>cn(t,!1),hn=t=>cn(t,!0);function un(t,e){return A(t,r=>t.moveVertically(r,e,tn(t)))}var Rt=t=>un(t,!1),It=t=>un(t,!0),gr=t=>A(t,e=>P(t,e,!0)),yr=t=>A(t,e=>P(t,e,!1)),xr=t=>A(t,e=>P(t,e,!y(t))),Sr=t=>A(t,e=>P(t,e,y(t))),kr=t=>A(t,e=>u.cursor(t.lineBlockAt(e.head).from)),Cr=t=>A(t,e=>u.cursor(t.lineBlockAt(e.head).to)),Ft=({state:t,dispatch:e})=>(e(E(t,{anchor:0})),!0),Wt=({state:t,dispatch:e})=>(e(E(t,{anchor:t.doc.length})),!0),Vt=({state:t,dispatch:e})=>(e(E(t,{anchor:t.selection.main.anchor,head:0})),!0),Ut=({state:t,dispatch:e})=>(e(E(t,{anchor:t.selection.main.anchor,head:t.doc.length})),!0),br=({state:t,dispatch:e})=>(e(t.update({selection:{anchor:0,head:t.doc.length},userEvent:"select"})),!0),Ar=({state:t,dispatch:e})=>{let r=xe(t).map(({from:n,to:o})=>u.range(n,Math.min(o+1,t.doc.length)));return e(t.update({selection:u.create(r),userEvent:"select"})),!0},Mr=({state:t,dispatch:e})=>{let r=N(t.selection,n=>{var o;let i=te(t).resolveInner(n.head,1);for(;!(i.from<n.from&&i.to>=n.to||i.to>n.to&&i.from<=n.from||!(!((o=i.parent)===null||o===void 0)&&o.parent));)i=i.parent;return u.range(i.to,i.from)});return e(E(t,r)),!0},vr=({state:t,dispatch:e})=>{let r=t.selection,n=null;return r.ranges.length>1?n=u.create([r.main]):r.main.empty||(n=u.create([u.cursor(r.main.head)])),n?(e(E(t,n)),!0):!1};function ye(t,e){if(t.state.readOnly)return!1;let r="delete.selection",{state:n}=t,o=n.changeByRange(i=>{let{from:l,to:s}=i;if(l==s){let c=e(l);c<l?(r="delete.backward",c=re(t,c,!1)):c>l&&(r="delete.forward",c=re(t,c,!0)),l=Math.min(l,c),s=Math.max(s,c)}else l=re(t,l,!1),s=re(t,s,!0);return l==s?{range:i}:{changes:{from:l,to:s},range:u.cursor(l)}});return o.changes.empty?!1:(t.dispatch(n.update(o,{scrollIntoView:!0,userEvent:r,effects:r=="delete.selection"?m.announce.of(n.phrase("Selection deleted")):void 0})),!0)}function re(t,e,r){if(t instanceof m)for(let n of t.state.facet(m.atomicRanges).map(o=>o(t)))n.between(e,e,(o,i)=>{o<e&&i>e&&(e=r?i:o)});return e}var fn=(t,e)=>ye(t,r=>{let{state:n}=t,o=n.doc.lineAt(r),i,l;if(!e&&r>o.from&&r<o.from+200&&!/[^ \t]/.test(i=o.text.slice(0,r-o.from))){if(i[i.length-1]=="	")return r-1;let s=Pe(i,n.tabSize),c=s%ne(n)||ne(n);for(let a=0;a<c&&i[i.length-1-a]==" ";a++)r--;l=r}else l=O(o.text,r-o.from,e,e)+o.from,l==r&&o.number!=(e?n.doc.lines:1)&&(l+=e?1:-1);return l}),ze=t=>fn(t,!1),dn=t=>fn(t,!0),mn=(t,e)=>ye(t,r=>{let n=r,{state:o}=t,i=o.doc.lineAt(n),l=o.charCategorizer(n);for(let s=null;;){if(n==(e?i.to:i.from)){n==r&&i.number!=(e?o.doc.lines:1)&&(n+=e?1:-1);break}let c=O(i.text,n-i.from,e)+i.from,a=i.text.slice(Math.min(n,c)-i.from,Math.max(n,c)-i.from),h=l(a);if(s!=null&&h!=s)break;(a!=" "||n!=r)&&(s=h),n=c}return n}),pn=t=>mn(t,!1),Lr=t=>mn(t,!0),gn=t=>ye(t,e=>{let r=t.lineBlockAt(e).to;return e<r?r:Math.min(t.state.doc.length,e+1)}),Br=t=>ye(t,e=>{let r=t.lineBlockAt(e).from;return e>r?r:Math.max(0,e-1)});var Dr=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let r=t.changeByRange(n=>({changes:{from:n.from,to:n.to,insert:Oe.of(["",""])},range:u.cursor(n.from)}));return e(t.update(r,{scrollIntoView:!0,userEvent:"input"})),!0},Er=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let r=t.changeByRange(n=>{if(!n.empty||n.from==0||n.from==t.doc.length)return{range:n};let o=n.from,i=t.doc.lineAt(o),l=o==i.from?o-1:O(i.text,o-i.from,!1)+i.from,s=o==i.to?o+1:O(i.text,o-i.from,!0)+i.from;return{changes:{from:l,to:s,insert:t.doc.slice(o,s).append(t.doc.slice(l,o))},range:u.cursor(s)}});return r.changes.empty?!1:(e(t.update(r,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function xe(t){let e=[],r=-1;for(let n of t.selection.ranges){let o=t.doc.lineAt(n.from),i=t.doc.lineAt(n.to);if(!n.empty&&n.to==i.from&&(i=t.doc.lineAt(n.to-1)),r>=o.number){let l=e[e.length-1];l.to=i.to,l.ranges.push(n)}else e.push({from:o.from,to:i.to,ranges:[n]});r=i.number+1}return e}function yn(t,e,r){if(t.readOnly)return!1;let n=[],o=[];for(let i of xe(t)){if(r?i.to==t.doc.length:i.from==0)continue;let l=t.doc.lineAt(r?i.to+1:i.from-1),s=l.length+1;if(r){n.push({from:i.to,to:l.to},{from:i.from,insert:l.text+t.lineBreak});for(let c of i.ranges)o.push(u.range(Math.min(t.doc.length,c.anchor+s),Math.min(t.doc.length,c.head+s)))}else{n.push({from:l.from,to:i.from},{from:i.to,insert:t.lineBreak+l.text});for(let c of i.ranges)o.push(u.range(c.anchor-s,c.head-s))}}return n.length?(e(t.update({changes:n,scrollIntoView:!0,selection:u.create(o,t.selection.mainIndex),userEvent:"move.line"})),!0):!1}var wr=({state:t,dispatch:e})=>yn(t,e,!1),Or=({state:t,dispatch:e})=>yn(t,e,!0);function xn(t,e,r){if(t.readOnly)return!1;let n=[];for(let o of xe(t))r?n.push({from:o.from,insert:t.doc.slice(o.from,o.to)+t.lineBreak}):n.push({from:o.to,insert:t.lineBreak+t.doc.slice(o.from,o.to)});return e(t.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}var Tr=({state:t,dispatch:e})=>xn(t,e,!1),Pr=({state:t,dispatch:e})=>xn(t,e,!0),Rr=t=>{if(t.state.readOnly)return!1;let{state:e}=t,r=e.changes(xe(e).map(({from:o,to:i})=>(o>0?o--:i<e.doc.length&&i++,{from:o,to:i}))),n=N(e.selection,o=>t.moveVertically(o,!0)).map(r);return t.dispatch({changes:r,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0};function Ir(t,e){if(/\(\)|\[\]|\{\}/.test(t.sliceDoc(e-1,e+1)))return{from:e,to:e};let r=te(t).resolveInner(e),n=r.childBefore(e),o=r.childAfter(e),i;return n&&o&&n.to<=e&&o.from>=e&&(i=n.type.prop(Y.closedBy))&&i.indexOf(o.name)>-1&&t.doc.lineAt(n.to).from==t.doc.lineAt(o.from).from?{from:n.to,to:o.from}:null}var Fr=Sn(!1),Wr=Sn(!0);function Sn(t){return({state:e,dispatch:r})=>{if(e.readOnly)return!1;let n=e.changeByRange(o=>{let{from:i,to:l}=o,s=e.doc.lineAt(i),c=!t&&i==l&&Ir(e,i);t&&(i=l=(l<=s.to?s:e.doc.lineAt(l)).to);let a=new Ve(e,{simulateBreak:i,simulateDoubleBreak:!!c}),h=We(a,i);for(h==null&&(h=/^\s*/.exec(e.doc.lineAt(i).text)[0].length);l<s.to&&/\s/.test(s.text[l-s.from]);)l++;c?{from:i,to:l}=c:i>s.from&&i<s.from+100&&!/\S/.test(s.text.slice(0,i))&&(i=s.from);let f=["",J(e,h)];return c&&f.push(J(e,a.lineIndent(s.from,-1))),{changes:{from:i,to:l,insert:Oe.of(f)},range:u.cursor(i+1+f[1].length)}});return r(e.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}function Je(t,e){let r=-1;return t.changeByRange(n=>{let o=[];for(let l=n.from;l<=n.to;){let s=t.doc.lineAt(l);s.number>r&&(n.empty||n.to>s.from)&&(e(s,o,n),r=s.number),l=s.to+1}let i=t.changes(o);return{changes:o,range:u.range(i.mapPos(n.anchor,1),i.mapPos(n.head,1))}})}var Vr=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let r=Object.create(null),n=new Ve(t,{overrideIndentation:i=>{let l=r[i];return l==null?-1:l}}),o=Je(t,(i,l,s)=>{let c=We(n,i.from);if(c==null)return;/\S/.test(i.text)||(c=0);let a=/^\s*/.exec(i.text)[0],h=J(t,c);(a!=h||s.from<i.from+a.length)&&(r[i.from]=c,l.push({from:i.from,to:i.from+a.length,insert:h}))});return o.changes.empty||e(t.update(o,{userEvent:"indent"})),!0},kn=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(Je(t,(r,n)=>{n.push({from:r.from,insert:t.facet(At)})}),{userEvent:"input.indent"})),!0),Cn=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(Je(t,(r,n)=>{let o=/^\s*/.exec(r.text)[0];if(!o)return;let i=Pe(o,t.tabSize),l=0,s=J(t,Math.max(0,i-ne(t)));for(;l<o.length&&l<s.length&&o.charCodeAt(l)==s.charCodeAt(l);)l++;n.push({from:r.from+l,to:r.from+o.length,insert:s.slice(l)})}),{userEvent:"delete.dedent"})),!0);var Ur=[{key:"Ctrl-b",run:jt,shift:on,preventDefault:!0},{key:"Ctrl-f",run:Qt,shift:ln},{key:"Ctrl-p",run:Zt,shift:an},{key:"Ctrl-n",run:en,shift:hn},{key:"Ctrl-a",run:cr,shift:kr},{key:"Ctrl-e",run:ar,shift:Cr},{key:"Ctrl-d",run:dn},{key:"Ctrl-h",run:ze},{key:"Ctrl-k",run:gn},{key:"Ctrl-Alt-h",run:pn},{key:"Ctrl-o",run:Dr},{key:"Ctrl-t",run:Er},{key:"Ctrl-v",run:Ge}],qr=[{key:"ArrowLeft",run:jt,shift:on,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:Zn,shift:fr,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:lr,shift:xr,preventDefault:!0},{key:"ArrowRight",run:Qt,shift:ln,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:er,shift:dr,preventDefault:!0},{mac:"Cmd-ArrowRight",run:sr,shift:Sr,preventDefault:!0},{key:"ArrowUp",run:Zt,shift:an,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Ft,shift:Vt},{mac:"Ctrl-ArrowUp",run:Pt,shift:Rt},{key:"ArrowDown",run:en,shift:hn,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Wt,shift:Ut},{mac:"Ctrl-ArrowDown",run:Ge,shift:It},{key:"PageUp",run:Pt,shift:Rt},{key:"PageDown",run:Ge,shift:It},{key:"Home",run:ir,shift:yr,preventDefault:!0},{key:"Mod-Home",run:Ft,shift:Vt},{key:"End",run:or,shift:gr,preventDefault:!0},{key:"Mod-End",run:Wt,shift:Ut},{key:"Enter",run:Fr},{key:"Mod-a",run:br},{key:"Backspace",run:ze,shift:ze},{key:"Delete",run:dn},{key:"Mod-Backspace",mac:"Alt-Backspace",run:pn},{key:"Mod-Delete",mac:"Alt-Delete",run:Lr},{mac:"Mod-Backspace",run:Br},{mac:"Mod-Delete",run:gn}].concat(Ur.map(t=>({mac:t.key,run:t.run,shift:t.shift}))),bn=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:nr,shift:mr},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:rr,shift:pr},{key:"Alt-ArrowUp",run:wr},{key:"Shift-Alt-ArrowUp",run:Tr},{key:"Alt-ArrowDown",run:Or},{key:"Shift-Alt-ArrowDown",run:Pr},{key:"Escape",run:vr},{key:"Mod-Enter",run:Wr},{key:"Alt-l",mac:"Ctrl-l",run:Ar},{key:"Mod-i",run:Mr,preventDefault:!0},{key:"Mod-[",run:Cn},{key:"Mod-]",run:kn},{key:"Mod-Alt-\\",run:Vr},{key:"Shift-Mod-k",run:Rr},{key:"Shift-Mod-\\",run:ur},{key:"Mod-/",run:In},{key:"Alt-A",run:Wn}].concat(qr),An={key:"Tab",run:kn,shift:Cn};B();D();B();D();function p(){var t=arguments[0];typeof t=="string"&&(t=document.createElement(t));var e=1,r=arguments[1];if(r&&typeof r=="object"&&r.nodeType==null&&!Array.isArray(r)){for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){var o=r[n];typeof o=="string"?t.setAttribute(n,o):o!=null&&(t[n]=o)}e++}for(;e<arguments.length;e++)Mn(t,arguments[e]);return t}function Mn(t,e){if(typeof e=="string")t.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)t.appendChild(e);else if(Array.isArray(e))for(var r=0;r<e.length;r++)Mn(t,e[r]);else throw new RangeError("Unsupported child node: "+e)}var vn=typeof String.prototype.normalize=="function"?t=>t.normalize("NFKD"):t=>t,F=class{constructor(e,r,n=0,o=e.length,i,l){this.test=l,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(n,o),this.bufferStart=n,this.normalize=i?s=>i(vn(s)):vn,this.query=this.normalize(r)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return ct(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let r=at(e),n=this.bufferStart+this.bufferPos;this.bufferPos+=ht(e);let o=this.normalize(r);for(let i=0,l=n;;i++){let s=o.charCodeAt(i),c=this.match(s,l);if(c)return this.value=c,this;if(i==o.length-1)break;l==n&&i<r.length&&r.charCodeAt(i)==s&&l++}}}match(e,r){let n=null;for(let o=0;o<this.matches.length;o+=2){let i=this.matches[o],l=!1;this.query.charCodeAt(i)==e&&(i==this.query.length-1?n={from:this.matches[o+1],to:r+1}:(this.matches[o]++,l=!0)),l||(this.matches.splice(o,2),o-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?n={from:r,to:r+1}:this.matches.push(1,r)),n&&this.test&&!this.test(n.from,n.to,this.buffer,this.bufferPos)&&(n=null),n}};typeof Symbol!="undefined"&&(F.prototype[Symbol.iterator]=function(){return this});var En={from:-1,to:-1,match:/.*/.exec("")},et="gm"+(/x/.unicode==null?"":"u"),Ce=class{constructor(e,r,n,o=0,i=e.length){if(this.text=e,this.to=i,this.curLine="",this.done=!1,this.value=En,/\\[sWDnr]|\n|\r|\[\^/.test(r))return new be(e,r,n,o,i);this.re=new RegExp(r,et+(n!=null&&n.ignoreCase?"i":"")),this.test=n==null?void 0:n.test,this.iter=e.iter();let l=e.lineAt(o);this.curLineStart=l.from,this.matchPos=Ae(e,o),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let r=this.matchPos<=this.to&&this.re.exec(this.curLine);if(r){let n=this.curLineStart+r.index,o=n+r[0].length;if(this.matchPos=Ae(this.text,o+(n==o?1:0)),n==this.curLineStart+this.curLine.length&&this.nextLine(),(n<o||n>this.value.to)&&(!this.test||this.test(n,o,r)))return this.value={from:n,to:o,match:r},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}},He=new WeakMap,R=class{constructor(e,r){this.from=e,this.text=r}get to(){return this.from+this.text.length}static get(e,r,n){let o=He.get(e);if(!o||o.from>=n||o.to<=r){let s=new R(r,e.sliceString(r,n));return He.set(e,s),s}if(o.from==r&&o.to==n)return o;let{text:i,from:l}=o;return l>r&&(i=e.sliceString(r,l)+i,l=r),o.to<n&&(i+=e.sliceString(o.to,n)),He.set(e,new R(l,i)),new R(r,i.slice(r-l,n-l))}},be=class{constructor(e,r,n,o,i){this.text=e,this.to=i,this.done=!1,this.value=En,this.matchPos=Ae(e,o),this.re=new RegExp(r,et+(n!=null&&n.ignoreCase?"i":"")),this.test=n==null?void 0:n.test,this.flat=R.get(e,o,this.chunkEnd(o+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,r=this.re.exec(this.flat.text);if(r&&!r[0]&&r.index==e&&(this.re.lastIndex=e+1,r=this.re.exec(this.flat.text)),r){let n=this.flat.from+r.index,o=n+r[0].length;if((this.flat.to>=this.to||r.index+r[0].length<=this.flat.text.length-10)&&(!this.test||this.test(n,o,r)))return this.value={from:n,to:o,match:r},this.matchPos=Ae(this.text,o+(n==o?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=R.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}};typeof Symbol!="undefined"&&(Ce.prototype[Symbol.iterator]=be.prototype[Symbol.iterator]=function(){return this});function Nr(t){try{return new RegExp(t,et),!0}catch(e){return!1}}function Ae(t,e){if(e>=t.length)return e;let r=t.lineAt(e),n;for(;e<r.to&&(n=r.text.charCodeAt(e-r.from))>=56320&&n<57344;)e++;return e}function je(t){let e=p("input",{class:"cm-textfield",name:"line"}),r=p("form",{class:"cm-gotoLine",onkeydown:o=>{o.keyCode==27?(o.preventDefault(),t.dispatch({effects:Me.of(!1)}),t.focus()):o.keyCode==13&&(o.preventDefault(),n())},onsubmit:o=>{o.preventDefault(),n()}},p("label",t.state.phrase("Go to line"),": ",e)," ",p("button",{class:"cm-button",type:"submit"},t.state.phrase("go")));function n(){let o=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!o)return;let{state:i}=t,l=i.doc.lineAt(i.selection.main.head),[,s,c,a,h]=o,f=a?+a.slice(1):0,d=c?+c:l.number;if(c&&h){let w=d/100;s&&(w=w*(s=="-"?-1:1)+l.number/i.doc.lines),d=Math.round(i.doc.lines*w)}else c&&s&&(d=d*(s=="-"?-1:1)+l.number);let W=i.doc.line(Math.max(1,Math.min(i.doc.lines,d)));t.dispatch({effects:Me.of(!1),selection:u.cursor(W.from+Math.max(0,Math.min(f,W.length))),scrollIntoView:!0}),t.focus()}return{dom:r}}var Me=T.define(),Ln=z.define({create(){return!0},update(t,e){for(let r of e.effects)r.is(Me)&&(t=r.value);return t},provide:t=>Fe.from(t,e=>e?je:null)}),_r=t=>{let e=$(t,je);if(!e){let r=[Me.of(!0)];t.state.field(Ln,!1)==null&&r.push(T.appendConfig.of([Ln,Gr])),t.dispatch({effects:r}),e=$(t,je)}return e&&e.dom.querySelector("input").focus(),!0},Gr=m.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),zr={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},wn=q.define({combine(t){return K(t,zr,{highlightWordAroundCursor:(e,r)=>e||r,minSelectionLength:Math.min,maxMatches:Math.min})}});function On(t){let e=[jr,Hr];return t&&e.push(wn.of(t)),e}var Kr=S.mark({class:"cm-selectionMatch"}),$r=S.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function Bn(t,e,r,n){return(r==0||t(e.sliceDoc(r-1,r))!=x.Word)&&(n==e.doc.length||t(e.sliceDoc(n,n+1))!=x.Word)}function Jr(t,e,r,n){return t(e.sliceDoc(r,r+1))==x.Word&&t(e.sliceDoc(n-1,n))==x.Word}var Hr=Re.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.selectionSet||t.docChanged||t.viewportChanged)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=t.state.facet(wn),{state:r}=t,n=r.selection;if(n.ranges.length>1)return S.none;let o=n.main,i,l=null;if(o.empty){if(!e.highlightWordAroundCursor)return S.none;let c=r.wordAt(o.head);if(!c)return S.none;l=r.charCategorizer(o.head),i=r.sliceDoc(c.from,c.to)}else{let c=o.to-o.from;if(c<e.minSelectionLength||c>200)return S.none;if(e.wholeWords){if(i=r.sliceDoc(o.from,o.to),l=r.charCategorizer(o.head),!(Bn(l,r,o.from,o.to)&&Jr(l,r,o.from,o.to)))return S.none}else if(i=r.sliceDoc(o.from,o.to).trim(),!i)return S.none}let s=[];for(let c of t.visibleRanges){let a=new F(r.doc,i,c.from,c.to);for(;!a.next().done;){let{from:h,to:f}=a.value;if((!l||Bn(l,r,h,f))&&(o.empty&&h<=o.from&&f>=o.to?s.push($r.range(h,f)):(h>=o.to||f<=o.from)&&s.push(Kr.range(h,f)),s.length>e.maxMatches))return S.none}}return S.set(s)}},{decorations:t=>t.decorations}),jr=m.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),Qr=({state:t,dispatch:e})=>{let{selection:r}=t,n=u.create(r.ranges.map(o=>t.wordAt(o.head)||u.cursor(o.head)),r.mainIndex);return n.eq(r)?!1:(e(t.update({selection:n})),!0)};function Xr(t,e){let{main:r,ranges:n}=t.selection,o=t.wordAt(r.head),i=o&&o.from==r.from&&o.to==r.to;for(let l=!1,s=new F(t.doc,e,n[n.length-1].to);;)if(s.next(),s.done){if(l)return null;s=new F(t.doc,e,0,Math.max(0,n[n.length-1].from-1)),l=!0}else{if(l&&n.some(c=>c.from==s.value.from))continue;if(i){let c=t.wordAt(s.value.from);if(!c||c.from!=s.value.from||c.to!=s.value.to)continue}return s.value}}var Yr=({state:t,dispatch:e})=>{let{ranges:r}=t.selection;if(r.some(i=>i.from===i.to))return Qr({state:t,dispatch:e});let n=t.sliceDoc(r[0].from,r[0].to);if(t.selection.ranges.some(i=>t.sliceDoc(i.from,i.to)!=n))return!1;let o=Xr(t,n);return o?(e(t.update({selection:t.selection.addRange(u.range(o.from,o.to),!1),effects:m.scrollIntoView(o.to)})),!0):!1},tt=q.define({combine(t){return K(t,{top:!1,caseSensitive:!1,literal:!1,wholeWord:!1,createPanel:e=>new Ze(e)})}});var ve=class{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||Nr(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(r,n)=>n=="n"?`
`:n=="r"?"\r":n=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new Xe(this):new Qe(this)}getCursor(e,r=0,n){let o=e.doc?e:ee.create({doc:e});return n==null&&(n=o.doc.length),this.regexp?G(this,o,r,n):_(this,o,r,n)}},Le=class{constructor(e){this.spec=e}};function _(t,e,r,n){return new F(e.doc,t.unquoted,r,n,t.caseSensitive?void 0:o=>o.toLowerCase(),t.wholeWord?Zr(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function Zr(t,e){return(r,n,o,i)=>((i>r||i+o.length<n)&&(i=Math.max(0,r-2),o=t.sliceString(i,Math.min(t.length,n+2))),(e(Be(o,r-i))!=x.Word||e(De(o,r-i))!=x.Word)&&(e(De(o,n-i))!=x.Word||e(Be(o,n-i))!=x.Word))}var Qe=class extends Le{constructor(e){super(e)}nextMatch(e,r,n){let o=_(this.spec,e,n,e.doc.length).nextOverlapping();return o.done&&(o=_(this.spec,e,0,r).nextOverlapping()),o.done?null:o.value}prevMatchInRange(e,r,n){for(let o=n;;){let i=Math.max(r,o-1e4-this.spec.unquoted.length),l=_(this.spec,e,i,o),s=null;for(;!l.nextOverlapping().done;)s=l.value;if(s)return s;if(i==r)return null;o-=1e4}}prevMatch(e,r,n){return this.prevMatchInRange(e,0,r)||this.prevMatchInRange(e,n,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,r){let n=_(this.spec,e,0,e.doc.length),o=[];for(;!n.next().done;){if(o.length>=r)return null;o.push(n.value)}return o}highlight(e,r,n,o){let i=_(this.spec,e,Math.max(0,r-this.spec.unquoted.length),Math.min(n+this.spec.unquoted.length,e.doc.length));for(;!i.next().done;)o(i.value.from,i.value.to)}};function G(t,e,r,n){return new Ce(e.doc,t.search,{ignoreCase:!t.caseSensitive,test:t.wholeWord?eo(e.charCategorizer(e.selection.main.head)):void 0},r,n)}function Be(t,e){return t.slice(O(t,e,!1),e)}function De(t,e){return t.slice(e,O(t,e))}function eo(t){return(e,r,n)=>!n[0].length||(t(Be(n.input,n.index))!=x.Word||t(De(n.input,n.index))!=x.Word)&&(t(De(n.input,n.index+n[0].length))!=x.Word||t(Be(n.input,n.index+n[0].length))!=x.Word)}var Xe=class extends Le{nextMatch(e,r,n){let o=G(this.spec,e,n,e.doc.length).next();return o.done&&(o=G(this.spec,e,0,r).next()),o.done?null:o.value}prevMatchInRange(e,r,n){for(let o=1;;o++){let i=Math.max(r,n-o*1e4),l=G(this.spec,e,i,n),s=null;for(;!l.next().done;)s=l.value;if(s&&(i==r||s.from>i+10))return s;if(i==r)return null}}prevMatch(e,r,n){return this.prevMatchInRange(e,0,r)||this.prevMatchInRange(e,n,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace.replace(/\$([$&\d+])/g,(r,n)=>n=="$"?"$":n=="&"?e.match[0]:n!="0"&&+n<e.match.length?e.match[n]:r))}matchAll(e,r){let n=G(this.spec,e,0,e.doc.length),o=[];for(;!n.next().done;){if(o.length>=r)return null;o.push(n.value)}return o}highlight(e,r,n,o){let i=G(this.spec,e,Math.max(0,r-250),Math.min(n+250,e.doc.length));for(;!i.next().done;)o(i.value.from,i.value.to)}},Q=T.define(),nt=T.define(),I=z.define({create(t){return new j(Ye(t).create(),null)},update(t,e){for(let r of e.effects)r.is(Q)?t=new j(r.value.create(),t.panel):r.is(nt)&&(t=new j(t.query,r.value?rt:null));return t},provide:t=>Fe.from(t,e=>e.panel)});var j=class{constructor(e,r){this.query=e,this.panel=r}},to=S.mark({class:"cm-searchMatch"}),no=S.mark({class:"cm-searchMatch cm-searchMatch-selected"}),ro=Re.fromClass(class{constructor(t){this.view=t,this.decorations=this.highlight(t.state.field(I))}update(t){let e=t.state.field(I);(e!=t.startState.field(I)||t.docChanged||t.selectionSet||t.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:t,panel:e}){if(!e||!t.spec.valid)return S.none;let{view:r}=this,n=new pt;for(let o=0,i=r.visibleRanges,l=i.length;o<l;o++){let{from:s,to:c}=i[o];for(;o<l-1&&c>i[o+1].from-2*250;)c=i[++o].to;t.highlight(r.state,s,c,(a,h)=>{let f=r.state.selection.ranges.some(d=>d.from==a&&d.to==h);n.add(a,h,f?no:to)})}return n.finish()}},{decorations:t=>t.decorations});function X(t){return e=>{let r=e.state.field(I,!1);return r&&r.query.spec.valid?t(e,r):Tn(e)}}var Ee=X((t,{query:e})=>{let{to:r}=t.state.selection.main,n=e.nextMatch(t.state,r,r);return n?(t.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:ot(t,n),userEvent:"select.search"}),!0):!1}),we=X((t,{query:e})=>{let{state:r}=t,{from:n}=r.selection.main,o=e.prevMatch(r,n,n);return o?(t.dispatch({selection:{anchor:o.from,head:o.to},scrollIntoView:!0,effects:ot(t,o),userEvent:"select.search"}),!0):!1}),oo=X((t,{query:e})=>{let r=e.matchAll(t.state,1e3);return!r||!r.length?!1:(t.dispatch({selection:u.create(r.map(n=>u.range(n.from,n.to))),userEvent:"select.search.matches"}),!0)}),io=({state:t,dispatch:e})=>{let r=t.selection;if(r.ranges.length>1||r.main.empty)return!1;let{from:n,to:o}=r.main,i=[],l=0;for(let s=new F(t.doc,t.sliceDoc(n,o));!s.next().done;){if(i.length>1e3)return!1;s.value.from==n&&(l=i.length),i.push(u.range(s.value.from,s.value.to))}return e(t.update({selection:u.create(i,l),userEvent:"select.search.matches"})),!0},Dn=X((t,{query:e})=>{let{state:r}=t,{from:n,to:o}=r.selection.main;if(r.readOnly)return!1;let i=e.nextMatch(r,n,n);if(!i)return!1;let l=[],s,c,a=[];if(i.from==n&&i.to==o&&(c=r.toText(e.getReplacement(i)),l.push({from:i.from,to:i.to,insert:c}),i=e.nextMatch(r,i.from,i.to),a.push(m.announce.of(r.phrase("replaced match on line $",r.doc.lineAt(n).number)+"."))),i){let h=l.length==0||l[0].from>=i.to?0:i.to-i.from-c.length;s={anchor:i.from-h,head:i.to-h},a.push(ot(t,i))}return t.dispatch({changes:l,selection:s,scrollIntoView:!!s,effects:a,userEvent:"input.replace"}),!0}),lo=X((t,{query:e})=>{if(t.state.readOnly)return!1;let r=e.matchAll(t.state,1e9).map(o=>{let{from:i,to:l}=o;return{from:i,to:l,insert:e.getReplacement(o)}});if(!r.length)return!1;let n=t.state.phrase("replaced $ matches",r.length)+".";return t.dispatch({changes:r,effects:m.announce.of(n),userEvent:"input.replace.all"}),!0});function rt(t){return t.state.facet(tt).createPanel(t)}function Ye(t,e){var r,n,o,i;let l=t.selection.main,s=l.empty||l.to>l.from+100?"":t.sliceDoc(l.from,l.to);if(e&&!s)return e;let c=t.facet(tt);return new ve({search:((r=e==null?void 0:e.literal)!==null&&r!==void 0?r:c.literal)?s:s.replace(/\n/g,"\\n"),caseSensitive:(n=e==null?void 0:e.caseSensitive)!==null&&n!==void 0?n:c.caseSensitive,literal:(o=e==null?void 0:e.literal)!==null&&o!==void 0?o:c.literal,wholeWord:(i=e==null?void 0:e.wholeWord)!==null&&i!==void 0?i:c.wholeWord})}var Tn=t=>{let e=t.state.field(I,!1);if(e&&e.panel){let r=$(t,rt);if(!r)return!1;let n=r.dom.querySelector("[main-field]");if(n&&n!=t.root.activeElement){let o=Ye(t.state,e.query.spec);o.valid&&t.dispatch({effects:Q.of(o)}),n.focus(),n.select()}}else t.dispatch({effects:[nt.of(!0),e?Q.of(Ye(t.state,e.query.spec)):T.appendConfig.of(co)]});return!0},Pn=t=>{let e=t.state.field(I,!1);if(!e||!e.panel)return!1;let r=$(t,rt);return r&&r.dom.contains(t.root.activeElement)&&t.focus(),t.dispatch({effects:nt.of(!1)}),!0},Rn=[{key:"Mod-f",run:Tn,scope:"editor search-panel"},{key:"F3",run:Ee,shift:we,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:Ee,shift:we,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:Pn,scope:"editor search-panel"},{key:"Mod-Shift-l",run:io},{key:"Alt-g",run:_r},{key:"Mod-d",run:Yr,preventDefault:!0}],Ze=class{constructor(e){this.view=e;let r=this.query=e.state.field(I).query.spec;this.commit=this.commit.bind(this),this.searchField=p("input",{value:r.search,placeholder:k(e,"Find"),"aria-label":k(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=p("input",{value:r.replace,placeholder:k(e,"Replace"),"aria-label":k(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=p("input",{type:"checkbox",name:"case",form:"",checked:r.caseSensitive,onchange:this.commit}),this.reField=p("input",{type:"checkbox",name:"re",form:"",checked:r.regexp,onchange:this.commit}),this.wordField=p("input",{type:"checkbox",name:"word",form:"",checked:r.wholeWord,onchange:this.commit});function n(o,i,l){return p("button",{class:"cm-button",name:o,onclick:i,type:"button"},l)}this.dom=p("div",{onkeydown:o=>this.keydown(o),class:"cm-search"},[this.searchField,n("next",()=>Ee(e),[k(e,"next")]),n("prev",()=>we(e),[k(e,"previous")]),n("select",()=>oo(e),[k(e,"all")]),p("label",null,[this.caseField,k(e,"match case")]),p("label",null,[this.reField,k(e,"regexp")]),p("label",null,[this.wordField,k(e,"by word")]),...e.state.readOnly?[]:[p("br"),this.replaceField,n("replace",()=>Dn(e),[k(e,"replace")]),n("replaceAll",()=>lo(e),[k(e,"replace all")]),p("button",{name:"close",onclick:()=>Pn(e),"aria-label":k(e,"close"),type:"button"},["\xD7"])]])}commit(){let e=new ve({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:Q.of(e)}))}keydown(e){yt(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?we:Ee)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),Dn(this.view))}update(e){for(let r of e.transactions)for(let n of r.effects)n.is(Q)&&!n.value.eq(this.query)&&this.setQuery(n.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(tt).top}};function k(t,e){return t.state.phrase(e)}var Se=30,ke=/[\s\.,:;?!]/;function ot(t,{from:e,to:r}){let n=t.state.doc.lineAt(e),o=t.state.doc.lineAt(r).to,i=Math.max(n.from,e-Se),l=Math.min(o,r+Se),s=t.state.sliceDoc(i,l);if(i!=n.from){for(let c=0;c<Se;c++)if(!ke.test(s[c+1])&&ke.test(s[c])){s=s.slice(c);break}}if(l!=o){for(let c=s.length-1;c>s.length-Se;c--)if(!ke.test(s[c-1])&&ke.test(s[c])){s=s.slice(0,c);break}}return m.announce.of(`${t.state.phrase("current match")}. ${s} ${t.state.phrase("on line")} ${n.number}.`)}var so=m.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),co=[I,dt.lowest(ro),so];B();D();var M=class extends st{constructor(){super(...arguments);this.extensions=()=>[];this.transformSource=r=>r;this.readonlyOrDisabled=new mt}static get styles(){return[it`
        ::slotted(*) {
          display: none;
        }

        :host[disabled] {
          pointer-events: none;
        }

        .cm-editor {
          background: #f9f9f9;
          padding: 12px;
        }

        .cm-content {
          white-space: pre-wrap !important;
        }

        .copy-code-wrap {
          position: absolute;
          bottom: 5px;
          right: 5px;
          z-index: 10;
          cursor: pointer;
        }

        .copy-code {
          height: 16px;
          width: 16px;
          position: relative;
          bottom: 0px;
          right: 0px;
          background: rgb(51, 154, 240);
          opacity: 50%;
          border-radius: 50%;
          z-index: 10;
          transition: all 0.2s ease 0s;
          color: white;
          font-size: xx-small;
        }

        .copy-code:hover {
          opacity: 100%;
        }

        .copy-code-wrap:active .copy-code {
          transform: translate(0, 0) scale(0.9);
        }

        .animate {
          transform: translate(0, 0) scale(1.12);
        }

        .tooltip {
          font-size: 15px;
          box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
        }
      `]}async refresh(r=void 0){if(r&&(this.code=await r()),!this.disabled&&this.editor&&(this.code||this.slotElement.assignedNodes().length>0)){let n=this.code?await this.transformSource(await this.code):await this.transformSource(this._readCode(this.slotElement));this.editor.dispatch({changes:{from:0,to:this.editor.state.doc.length,insert:n}})}}render(){return lt`
      <div style="position: relative">
        <!-- button to copy the editor -->
        <div class="copy-code-wrap" @click="${()=>this._copyCode()}">
          <omni-icon class="copy-code" icon="@material/content_copy" size="${"custom"}"></omni-icon>
        </div>
        <!-- CodeMirror Editor parent element -->
        <div class="code-parent"> </div>
      </div>
      <slot @slotchange="${()=>this._slotChanged()}"></slot>
    `}async updated(r){if(!this.editor&&this.codeParent&&(this.code||this.slotElement.assignedNodes().length>0)){let n=this.code?await this.transformSource(await this.code):await this.transformSource(this._readCode(this.slotElement));this._clearElements(this.codeParent),this.editor=new m({doc:n,extensions:[[this.readOnly||this.disabled?[]:[bt(),St(),Gt(),xt(),Mt(),Bt(),Dt(),wt(),kt(),Ie.of([...Et,...bn,...Rn,...Jt,...Ot])],vt(Lt,{fallback:!0}),Ct(),On()],await this.extensions(),this.readonlyOrDisabled.of([ee.readOnly.of(this.readOnly||this.disabled),m.editable.of(!this.readOnly&&!this.disabled)]),Ie.of(this.noTab?[]:[An]),m.updateListener.of(async o=>{if(o.docChanged){let i=n;n=this.editor.state.doc.toString(),this.code=n,this.requestUpdate(),await this.updateComplete,this.disabled||(this.dispatchEvent(new CustomEvent("codemirror-update",{detail:{update:o,editor:this.editor,source:this.editor.state.doc.toString()}})),this.dispatchEvent(new CustomEvent("codemirror-source-change",{detail:{update:o,editor:this.editor,oldSource:i,source:n}})))}else this.disabled||this.dispatchEvent(new CustomEvent("codemirror-update",{detail:{update:o,editor:this.editor,source:this.editor.state.doc.toString()}}))})],parent:this.codeParent}),this.disabled||this.dispatchEvent(new CustomEvent("codemirror-loaded",{detail:{editor:this.editor,source:this.editor.state.doc.toString()}}))}}async _copyCode(){this._copyTextToClipboard(await this.code)}_fallbackCopyTextToClipboard(r){let n=document.createElement("textarea");n.value=r,n.style.top="0",n.style.left="0",n.style.position="fixed",document.body.appendChild(n),n.focus(),n.select();try{document.execCommand("copy")}catch(o){console.error(o)}document.body.removeChild(n)}_copyTextToClipboard(r){if(!navigator.clipboard){this._fallbackCopyTextToClipboard(r);return}navigator.clipboard.writeText(r).then(void 0,n=>{console.error("Attempting fallback, could not copy text: ",n),this._fallbackCopyTextToClipboard(r)})}async _slotChanged(){if(!this.editor)return;let r=this.code?await this.transformSource(await this.code):await this.transformSource(this._readCode(this.slotElement));!this.disabled&&r!==this.editor.state.doc.toString()&&this.editor.dispatch({changes:{from:0,to:this.editor.state.doc.length,insert:r}})}_readCode(r){return r.assignedNodes().map(o=>o instanceof Element?o.outerHTML:o.textContent).join(`\r
`)}_clearElements(r=void 0){r||(r=this.renderRoot);let n=r.lastElementChild;for(;n;){let o=n;n=n.previousElementSibling,o.hasAttribute("slot")||r.removeChild(o)}}};L([U({type:Object,reflect:!1})],M.prototype,"extensions",2),L([U({type:Object,reflect:!1})],M.prototype,"transformSource",2),L([U({type:String,reflect:!0})],M.prototype,"code",2),L([U({type:Boolean,attribute:"read-only",reflect:!0})],M.prototype,"readOnly",2),L([U({type:Boolean,reflect:!0})],M.prototype,"disabled",2),L([U({type:Boolean,attribute:"no-tab",reflect:!0})],M.prototype,"noTab",2),L([Ue(".code-parent")],M.prototype,"codeParent",2),L([Ue("slot")],M.prototype,"slotElement",2),M=L([Tt("code-editor")],M);export{M as a};
//# sourceMappingURL=chunk.3ZSQQRRC.js.map
