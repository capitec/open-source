import{A as ee,B as K,C as Pt,D as Ie,E as k,F as Fe,G as Rt,H as m,I as te,J as It,K as We,L as Ve,M as Ue,N as qe,O as $,P as Ne,Q as _e,S as ne,U as Ft,V as re,W as J,X as ze,Y as Ge,a as Y,ba as Ke,fa as $e,ga as Je,ha as He,ia as V,k as Te,l as O,m as Bt,ma as je,n as Et,na as Qe,o as wt,oa as Xe,p as Dt,pa as Ye,q as Ot,r as u,s as q,t as G,u as Tt,v as Pe,w as Re,x as T,y as Z,z as x}from"./chunk.63SH7AJG.js";import{a as Wt,b as U,d as Ze}from"./chunk.CHYIO324.js";import{b as At,c as Mt,h as Lt}from"./chunk.CDDA2I3H.js";import{j as L,l as B,o as E}from"./chunk.2ZZQBHAA.js";B();E();B();E();var In=t=>{let e=st(t.state);return e.line?Fn(t):e.block?Vn(t):!1};function it(t,e){return({state:n,dispatch:r})=>{if(n.readOnly)return!1;let o=t(e,n);return o?(r(n.update(o)),!0):!1}}var Fn=it(Nn,0);var Wn=it(Kt,0);var Vn=it((t,e)=>Kt(t,e,qn(e)),0);function st(t,e=t.selection.main.head){let n=t.languageDataAt("commentTokens",e);return n.length?n[0]:{}}var H=50;function Un(t,{open:e,close:n},r,o){let i=t.sliceDoc(r-H,r),s=t.sliceDoc(o,o+H),l=/\s*$/.exec(i)[0].length,c=/^\s*/.exec(s)[0].length,a=i.length-l;if(i.slice(a-e.length,a)==e&&s.slice(c,c+n.length)==n)return{open:{pos:r-l,margin:l&&1},close:{pos:o+c,margin:c&&1}};let h,f;o-r<=2*H?h=f=t.sliceDoc(r,o):(h=t.sliceDoc(r,r+H),f=t.sliceDoc(o-H,o));let d=/^\s*/.exec(h)[0].length,W=/\s*$/.exec(f)[0].length,D=f.length-W-n.length;return h.slice(d,d+e.length)==e&&f.slice(D,D+n.length)==n?{open:{pos:r+d+e.length,margin:/\s/.test(h.charAt(d+e.length))?1:0},close:{pos:o-W-n.length,margin:/\s/.test(f.charAt(D-1))?1:0}}:null}function qn(t){let e=[];for(let n of t.selection.ranges){let r=t.doc.lineAt(n.from),o=n.to<=r.to?r:t.doc.lineAt(n.to),i=e.length-1;i>=0&&e[i].to>r.from?e[i].to=o.to:e.push({from:r.from,to:o.to})}return e}function Kt(t,e,n=e.selection.ranges){let r=n.map(i=>st(e,i.from).block);if(!r.every(i=>i))return null;let o=n.map((i,s)=>Un(e,r[s],i.from,i.to));if(t!=2&&!o.every(i=>i))return{changes:e.changes(n.map((i,s)=>o[s]?[]:[{from:i.from,insert:r[s].open+" "},{from:i.to,insert:" "+r[s].close}]))};if(t!=1&&o.some(i=>i)){let i=[];for(let s=0,l;s<o.length;s++)if(l=o[s]){let c=r[s],{open:a,close:h}=l;i.push({from:a.pos-c.open.length,to:a.pos+a.margin},{from:h.pos-h.margin,to:h.pos+c.close.length})}return{changes:i}}return null}function Nn(t,e,n=e.selection.ranges){let r=[],o=-1;for(let{from:i,to:s}of n){let l=r.length,c=1e9;for(let a=i;a<=s;){let h=e.doc.lineAt(a);if(h.from>o&&(i==s||s>h.from)){o=h.from;let f=st(e,a).line;if(!f)continue;let d=/^\s*/.exec(h.text)[0].length,W=d==h.length,D=h.text.slice(d,d+f.length)==f?d:-1;d<h.text.length&&d<c&&(c=d),r.push({line:h,comment:D,token:f,indent:d,empty:W,single:!1})}a=h.to+1}if(c<1e9)for(let a=l;a<r.length;a++)r[a].indent<r[a].line.text.length&&(r[a].indent=c);r.length==l+1&&(r[l].single=!0)}if(t!=2&&r.some(i=>i.comment<0&&(!i.empty||i.single))){let i=[];for(let{line:l,token:c,indent:a,empty:h,single:f}of r)(f||!h)&&i.push({from:l.from+a,insert:c+" "});let s=e.changes(i);return{changes:s,selection:e.selection.map(s,1)}}else if(t!=1&&r.some(i=>i.comment>=0)){let i=[];for(let{line:s,comment:l,token:c}of r)if(l>=0){let a=s.from+l,h=a+c.length;s.text[h-s.from]==" "&&h++,i.push({from:a,to:h})}return{changes:i}}return null}var tt=Re.define(),_n=Re.define(),zn=q.define(),$t=q.define({combine(t){return K(t,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})}});function Gn(t){let e=0;return t.iterChangedRanges((n,r)=>e=r),e}var Jt=G.define({create(){return C.empty},update(t,e){let n=e.state.facet($t),r=e.annotation(tt);if(r){let c=e.docChanged?u.single(Gn(e.changes)):void 0,a=g.fromTransaction(e,c),h=r.side,f=h==0?t.undone:t.done;return a?f=ie(f,f.length,n.minDepth,a):f=Qt(f,e.startState.selection),new C(h==0?r.rest:f,h==0?f:r.rest)}let o=e.annotation(_n);if((o=="full"||o=="before")&&(t=t.isolate()),e.annotation(Z.addToHistory)===!1)return e.changes.empty?t:t.addMapping(e.changes.desc);let i=g.fromTransaction(e),s=e.annotation(Z.time),l=e.annotation(Z.userEvent);return i?t=t.addChanges(i,s,l,n.newGroupDelay,n.minDepth):e.selection&&(t=t.addSelection(e.startState.selection,s,l,n.newGroupDelay)),(o=="full"||o=="after")&&(t=t.isolate()),t},toJSON(t){return{done:t.done.map(e=>e.toJSON()),undone:t.undone.map(e=>e.toJSON())}},fromJSON(t){return new C(t.done.map(g.fromJSON),t.undone.map(g.fromJSON))}});function lt(t={}){return[Jt,$t.of(t),m.domEventHandlers({beforeinput(e,n){let r=e.inputType=="historyUndo"?Ht:e.inputType=="historyRedo"?nt:null;return r?(e.preventDefault(),r(n)):!1}})]}function pe(t,e){return function({state:n,dispatch:r}){if(!e&&n.readOnly)return!1;let o=n.field(Jt,!1);if(!o)return!1;let i=o.pop(t,n,e);return i?(r(i),!0):!1}}var Ht=pe(0,!1),nt=pe(1,!1),Kn=pe(0,!0),$n=pe(1,!0);var g=class{constructor(e,n,r,o,i){this.changes=e,this.effects=n,this.mapped=r,this.startSelection=o,this.selectionsAfter=i}setSelAfter(e){return new g(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,n,r;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(n=this.mapped)===null||n===void 0?void 0:n.toJSON(),startSelection:(r=this.startSelection)===null||r===void 0?void 0:r.toJSON(),selectionsAfter:this.selectionsAfter.map(o=>o.toJSON())}}static fromJSON(e){return new g(e.changes&&Ot.fromJSON(e.changes),[],e.mapped&&Dt.fromJSON(e.mapped),e.startSelection&&u.fromJSON(e.startSelection),e.selectionsAfter.map(u.fromJSON))}static fromTransaction(e,n){let r=b;for(let o of e.startState.facet(zn)){let i=o(e);i.length&&(r=r.concat(i))}return!r.length&&e.changes.empty?null:new g(e.changes.invert(e.startState.doc),r,void 0,n||e.startState.selection,b)}static selection(e){return new g(void 0,b,void 0,void 0,e)}};function ie(t,e,n,r){let o=e+1>n+20?e-n-1:0,i=t.slice(o,e);return i.push(r),i}function Jn(t,e){let n=[],r=!1;return t.iterChangedRanges((o,i)=>n.push(o,i)),e.iterChangedRanges((o,i,s,l)=>{for(let c=0;c<n.length;){let a=n[c++],h=n[c++];l>=a&&s<=h&&(r=!0)}}),r}function Hn(t,e){return t.ranges.length==e.ranges.length&&t.ranges.filter((n,r)=>n.empty!=e.ranges[r].empty).length===0}function jt(t,e){return t.length?e.length?t.concat(e):t:e}var b=[],jn=200;function Qt(t,e){if(t.length){let n=t[t.length-1],r=n.selectionsAfter.slice(Math.max(0,n.selectionsAfter.length-jn));return r.length&&r[r.length-1].eq(e)?t:(r.push(e),ie(t,t.length-1,1e9,n.setSelAfter(r)))}else return[g.selection([e])]}function Qn(t){let e=t[t.length-1],n=t.slice();return n[t.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),n}function et(t,e){if(!t.length)return t;let n=t.length,r=b;for(;n;){let o=Xn(t[n-1],e,r);if(o.changes&&!o.changes.empty||o.effects.length){let i=t.slice(0,n);return i[n-1]=o,i}else e=o.mapped,n--,r=o.selectionsAfter}return r.length?[g.selection(r)]:b}function Xn(t,e,n){let r=jt(t.selectionsAfter.length?t.selectionsAfter.map(l=>l.map(e)):b,n);if(!t.changes)return g.selection(r);let o=t.changes.map(e),i=e.mapDesc(t.changes,!0),s=t.mapped?t.mapped.composeDesc(i):i;return new g(o,T.mapEffects(t.effects,e),s,t.startSelection.map(i),r)}var Yn=/^(input\.type|delete)($|\.)/,C=class{constructor(e,n,r=0,o=void 0){this.done=e,this.undone=n,this.prevTime=r,this.prevUserEvent=o}isolate(){return this.prevTime?new C(this.done,this.undone):this}addChanges(e,n,r,o,i){let s=this.done,l=s[s.length-1];return l&&l.changes&&!l.changes.empty&&e.changes&&(!r||Yn.test(r))&&(!l.selectionsAfter.length&&n-this.prevTime<o&&Jn(l.changes,e.changes)||r=="input.type.compose")?s=ie(s,s.length-1,i,new g(e.changes.compose(l.changes),jt(e.effects,l.effects),l.mapped,l.startSelection,b)):s=ie(s,s.length,i,e),new C(s,b,n,r)}addSelection(e,n,r,o){let i=this.done.length?this.done[this.done.length-1].selectionsAfter:b;return i.length>0&&n-this.prevTime<o&&r==this.prevUserEvent&&r&&/^select($|\.)/.test(r)&&Hn(i[i.length-1],e)?this:new C(Qt(this.done,e),this.undone,n,r)}addMapping(e){return new C(et(this.done,e),et(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,n,r){let o=e==0?this.done:this.undone;if(o.length==0)return null;let i=o[o.length-1];if(r&&i.selectionsAfter.length)return n.update({selection:i.selectionsAfter[i.selectionsAfter.length-1],annotations:tt.of({side:e,rest:Qn(o)}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(i.changes){let s=o.length==1?b:o.slice(0,o.length-1);return i.mapped&&(s=et(s,i.mapped)),n.update({changes:i.changes,selection:i.startSelection,effects:i.effects,annotations:tt.of({side:e,rest:s}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}};C.empty=new C(b,b);var ct=[{key:"Mod-z",run:Ht,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:nt,preventDefault:!0},{linux:"Ctrl-Shift-z",run:nt,preventDefault:!0},{key:"Mod-u",run:Kn,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:$n,preventDefault:!0}];function N(t,e){return u.create(t.ranges.map(e),t.mainIndex)}function w(t,e){return t.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function M({state:t,dispatch:e},n){let r=N(t.selection,n);return r.eq(t.selection)?!1:(e(w(t,r)),!0)}function ge(t,e){return u.cursor(e?t.to:t.from)}function Xt(t,e){return M(t,n=>n.empty?t.moveByChar(n,e):ge(n,e))}function y(t){return t.textDirectionAt(t.state.selection.main.head)==Rt.LTR}var Yt=t=>Xt(t,!y(t)),Zt=t=>Xt(t,y(t));function en(t,e){return M(t,n=>n.empty?t.moveByGroup(n,e):ge(n,e))}var Zn=t=>en(t,!y(t)),er=t=>en(t,y(t));function tr(t,e,n){if(e.type.prop(n))return!0;let r=e.to-e.from;return r&&(r>2||/[^\s,.;:]/.test(t.sliceDoc(e.from,e.to)))||e.firstChild}function ye(t,e,n){let r=ne(t).resolveInner(e.head),o=n?Y.closedBy:Y.openedBy;for(let c=e.head;;){let a=n?r.childAfter(c):r.childBefore(c);if(!a)break;tr(t,a,o)?r=a:c=n?a.to:a.from}let i=r.type.prop(o),s,l;return i&&(s=n?V(t,r.from,1):V(t,r.to,-1))&&s.matched?l=n?s.end.to:s.end.from:l=n?r.to:r.from,u.cursor(l,n?-1:1)}var nr=t=>M(t,e=>ye(t.state,e,!y(t))),rr=t=>M(t,e=>ye(t.state,e,y(t)));function tn(t,e){return M(t,n=>{if(!n.empty)return ge(n,e);let r=t.moveVertically(n,e);return r.head!=n.head?r:t.moveToLineBoundary(n,e)})}var nn=t=>tn(t,!1),rn=t=>tn(t,!0);function on(t){return Math.max(t.defaultLineHeight,Math.min(t.dom.clientHeight,innerHeight)-5)}function sn(t,e){let{state:n}=t,r=N(n.selection,l=>l.empty?t.moveVertically(l,e,on(t)):ge(l,e));if(r.eq(n.selection))return!1;let o=t.coordsAtPos(n.selection.main.head),i=t.scrollDOM.getBoundingClientRect(),s;return o&&o.top>i.top&&o.bottom<i.bottom&&o.top-i.top<=t.scrollDOM.scrollHeight-t.scrollDOM.scrollTop-t.scrollDOM.clientHeight&&(s=m.scrollIntoView(r.main.head,{y:"start",yMargin:o.top-i.top})),t.dispatch(w(n,r),{effects:s}),!0}var Vt=t=>sn(t,!1),rt=t=>sn(t,!0);function P(t,e,n){let r=t.lineBlockAt(e.head),o=t.moveToLineBoundary(e,n);if(o.head==e.head&&o.head!=(n?r.to:r.from)&&(o=t.moveToLineBoundary(e,n,!1)),!n&&o.head==r.from&&r.length){let i=/^\s*/.exec(t.state.sliceDoc(r.from,Math.min(r.from+100,r.to)))[0].length;i&&e.head!=r.from+i&&(o=u.cursor(r.from+i))}return o}var or=t=>M(t,e=>P(t,e,!0)),ir=t=>M(t,e=>P(t,e,!1)),sr=t=>M(t,e=>P(t,e,!y(t))),lr=t=>M(t,e=>P(t,e,y(t))),cr=t=>M(t,e=>u.cursor(t.lineBlockAt(e.head).from,1)),ar=t=>M(t,e=>u.cursor(t.lineBlockAt(e.head).to,-1));function hr(t,e,n){let r=!1,o=N(t.selection,i=>{let s=V(t,i.head,-1)||V(t,i.head,1)||i.head>0&&V(t,i.head-1,1)||i.head<t.doc.length&&V(t,i.head+1,-1);if(!s||!s.end)return i;r=!0;let l=s.start.from==i.head?s.end.to:s.end.from;return n?u.range(i.anchor,l):u.cursor(l)});return r?(e(w(t,o)),!0):!1}var ur=({state:t,dispatch:e})=>hr(t,e,!1);function v(t,e){let n=N(t.state.selection,r=>{let o=e(r);return u.range(r.anchor,o.head,o.goalColumn)});return n.eq(t.state.selection)?!1:(t.dispatch(w(t.state,n)),!0)}function ln(t,e){return v(t,n=>t.moveByChar(n,e))}var cn=t=>ln(t,!y(t)),an=t=>ln(t,y(t));function hn(t,e){return v(t,n=>t.moveByGroup(n,e))}var fr=t=>hn(t,!y(t)),dr=t=>hn(t,y(t));var mr=t=>v(t,e=>ye(t.state,e,!y(t))),pr=t=>v(t,e=>ye(t.state,e,y(t)));function un(t,e){return v(t,n=>t.moveVertically(n,e))}var fn=t=>un(t,!1),dn=t=>un(t,!0);function mn(t,e){return v(t,n=>t.moveVertically(n,e,on(t)))}var Ut=t=>mn(t,!1),qt=t=>mn(t,!0),gr=t=>v(t,e=>P(t,e,!0)),yr=t=>v(t,e=>P(t,e,!1)),xr=t=>v(t,e=>P(t,e,!y(t))),kr=t=>v(t,e=>P(t,e,y(t))),Sr=t=>v(t,e=>u.cursor(t.lineBlockAt(e.head).from)),br=t=>v(t,e=>u.cursor(t.lineBlockAt(e.head).to)),Nt=({state:t,dispatch:e})=>(e(w(t,{anchor:0})),!0),_t=({state:t,dispatch:e})=>(e(w(t,{anchor:t.doc.length})),!0),zt=({state:t,dispatch:e})=>(e(w(t,{anchor:t.selection.main.anchor,head:0})),!0),Gt=({state:t,dispatch:e})=>(e(w(t,{anchor:t.selection.main.anchor,head:t.doc.length})),!0),Cr=({state:t,dispatch:e})=>(e(t.update({selection:{anchor:0,head:t.doc.length},userEvent:"select"})),!0),vr=({state:t,dispatch:e})=>{let n=ke(t).map(({from:r,to:o})=>u.range(r,Math.min(o+1,t.doc.length)));return e(t.update({selection:u.create(n),userEvent:"select"})),!0},Ar=({state:t,dispatch:e})=>{let n=N(t.selection,r=>{var o;let i=ne(t).resolveInner(r.head,1);for(;!(i.from<r.from&&i.to>=r.to||i.to>r.to&&i.from<=r.from||!(!((o=i.parent)===null||o===void 0)&&o.parent));)i=i.parent;return u.range(i.to,i.from)});return e(w(t,n)),!0},Mr=({state:t,dispatch:e})=>{let n=t.selection,r=null;return n.ranges.length>1?r=u.create([n.main]):n.main.empty||(r=u.create([u.cursor(n.main.head)])),r?(e(w(t,r)),!0):!1};function xe(t,e){if(t.state.readOnly)return!1;let n="delete.selection",{state:r}=t,o=r.changeByRange(i=>{let{from:s,to:l}=i;if(s==l){let c=e(s);c<s?(n="delete.backward",c=oe(t,c,!1)):c>s&&(n="delete.forward",c=oe(t,c,!0)),s=Math.min(s,c),l=Math.max(l,c)}else s=oe(t,s,!1),l=oe(t,l,!0);return s==l?{range:i}:{changes:{from:s,to:l},range:u.cursor(s)}});return o.changes.empty?!1:(t.dispatch(r.update(o,{scrollIntoView:!0,userEvent:n,effects:n=="delete.selection"?m.announce.of(r.phrase("Selection deleted")):void 0})),!0)}function oe(t,e,n){if(t instanceof m)for(let r of t.state.facet(m.atomicRanges).map(o=>o(t)))r.between(e,e,(o,i)=>{o<e&&i>e&&(e=n?i:o)});return e}var pn=(t,e)=>xe(t,n=>{let{state:r}=t,o=r.doc.lineAt(n),i,s;if(!e&&n>o.from&&n<o.from+200&&!/[^ \t]/.test(i=o.text.slice(0,n-o.from))){if(i[i.length-1]=="	")return n-1;let l=Ie(i,r.tabSize),c=l%re(r)||re(r);for(let a=0;a<c&&i[i.length-1-a]==" ";a++)n--;s=n}else s=O(o.text,n-o.from,e,e)+o.from,s==n&&o.number!=(e?r.doc.lines:1)&&(s+=e?1:-1);return s}),ot=t=>pn(t,!1),gn=t=>pn(t,!0),yn=(t,e)=>xe(t,n=>{let r=n,{state:o}=t,i=o.doc.lineAt(r),s=o.charCategorizer(r);for(let l=null;;){if(r==(e?i.to:i.from)){r==n&&i.number!=(e?o.doc.lines:1)&&(r+=e?1:-1);break}let c=O(i.text,r-i.from,e)+i.from,a=i.text.slice(Math.min(r,c)-i.from,Math.max(r,c)-i.from),h=s(a);if(l!=null&&h!=l)break;(a!=" "||r!=n)&&(l=h),r=c}return r}),xn=t=>yn(t,!1),Lr=t=>yn(t,!0),kn=t=>xe(t,e=>{let n=t.lineBlockAt(e).to;return e<n?n:Math.min(t.state.doc.length,e+1)}),Br=t=>xe(t,e=>{let n=t.lineBlockAt(e).from;return e>n?n:Math.max(0,e-1)});var Er=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let n=t.changeByRange(r=>({changes:{from:r.from,to:r.to,insert:Te.of(["",""])},range:u.cursor(r.from)}));return e(t.update(n,{scrollIntoView:!0,userEvent:"input"})),!0},wr=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let n=t.changeByRange(r=>{if(!r.empty||r.from==0||r.from==t.doc.length)return{range:r};let o=r.from,i=t.doc.lineAt(o),s=o==i.from?o-1:O(i.text,o-i.from,!1)+i.from,l=o==i.to?o+1:O(i.text,o-i.from,!0)+i.from;return{changes:{from:s,to:l,insert:t.doc.slice(o,l).append(t.doc.slice(s,o))},range:u.cursor(l)}});return n.changes.empty?!1:(e(t.update(n,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function ke(t){let e=[],n=-1;for(let r of t.selection.ranges){let o=t.doc.lineAt(r.from),i=t.doc.lineAt(r.to);if(!r.empty&&r.to==i.from&&(i=t.doc.lineAt(r.to-1)),n>=o.number){let s=e[e.length-1];s.to=i.to,s.ranges.push(r)}else e.push({from:o.from,to:i.to,ranges:[r]});n=i.number+1}return e}function Sn(t,e,n){if(t.readOnly)return!1;let r=[],o=[];for(let i of ke(t)){if(n?i.to==t.doc.length:i.from==0)continue;let s=t.doc.lineAt(n?i.to+1:i.from-1),l=s.length+1;if(n){r.push({from:i.to,to:s.to},{from:i.from,insert:s.text+t.lineBreak});for(let c of i.ranges)o.push(u.range(Math.min(t.doc.length,c.anchor+l),Math.min(t.doc.length,c.head+l)))}else{r.push({from:s.from,to:i.from},{from:i.to,insert:t.lineBreak+s.text});for(let c of i.ranges)o.push(u.range(c.anchor-l,c.head-l))}}return r.length?(e(t.update({changes:r,scrollIntoView:!0,selection:u.create(o,t.selection.mainIndex),userEvent:"move.line"})),!0):!1}var Dr=({state:t,dispatch:e})=>Sn(t,e,!1),Or=({state:t,dispatch:e})=>Sn(t,e,!0);function bn(t,e,n){if(t.readOnly)return!1;let r=[];for(let o of ke(t))n?r.push({from:o.from,insert:t.doc.slice(o.from,o.to)+t.lineBreak}):r.push({from:o.to,insert:t.lineBreak+t.doc.slice(o.from,o.to)});return e(t.update({changes:r,scrollIntoView:!0,userEvent:"input.copyline"})),!0}var Tr=({state:t,dispatch:e})=>bn(t,e,!1),Pr=({state:t,dispatch:e})=>bn(t,e,!0),Rr=t=>{if(t.state.readOnly)return!1;let{state:e}=t,n=e.changes(ke(e).map(({from:o,to:i})=>(o>0?o--:i<e.doc.length&&i++,{from:o,to:i}))),r=N(e.selection,o=>t.moveVertically(o,!0)).map(n);return t.dispatch({changes:n,selection:r,scrollIntoView:!0,userEvent:"delete.line"}),!0};function Ir(t,e){if(/\(\)|\[\]|\{\}/.test(t.sliceDoc(e-1,e+1)))return{from:e,to:e};let n=ne(t).resolveInner(e),r=n.childBefore(e),o=n.childAfter(e),i;return r&&o&&r.to<=e&&o.from>=e&&(i=r.type.prop(Y.closedBy))&&i.indexOf(o.name)>-1&&t.doc.lineAt(r.to).from==t.doc.lineAt(o.from).from?{from:r.to,to:o.from}:null}var Fr=Cn(!1),Wr=Cn(!0);function Cn(t){return({state:e,dispatch:n})=>{if(e.readOnly)return!1;let r=e.changeByRange(o=>{let{from:i,to:s}=o,l=e.doc.lineAt(i),c=!t&&i==s&&Ir(e,i);t&&(i=s=(s<=l.to?l:e.doc.lineAt(s)).to);let a=new Ge(e,{simulateBreak:i,simulateDoubleBreak:!!c}),h=ze(a,i);for(h==null&&(h=/^\s*/.exec(e.doc.lineAt(i).text)[0].length);s<l.to&&/\s/.test(l.text[s-l.from]);)s++;c?{from:i,to:s}=c:i>l.from&&i<l.from+100&&!/\S/.test(l.text.slice(0,i))&&(i=l.from);let f=["",J(e,h)];return c&&f.push(J(e,a.lineIndent(l.from,-1))),{changes:{from:i,to:s,insert:Te.of(f)},range:u.cursor(i+1+f[1].length)}});return n(e.update(r,{scrollIntoView:!0,userEvent:"input"})),!0}}function at(t,e){let n=-1;return t.changeByRange(r=>{let o=[];for(let s=r.from;s<=r.to;){let l=t.doc.lineAt(s);l.number>n&&(r.empty||r.to>l.from)&&(e(l,o,r),n=l.number),s=l.to+1}let i=t.changes(o);return{changes:o,range:u.range(i.mapPos(r.anchor,1),i.mapPos(r.head,1))}})}var Vr=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let n=Object.create(null),r=new Ge(t,{overrideIndentation:i=>{let s=n[i];return s==null?-1:s}}),o=at(t,(i,s,l)=>{let c=ze(r,i.from);if(c==null)return;/\S/.test(i.text)||(c=0);let a=/^\s*/.exec(i.text)[0],h=J(t,c);(a!=h||l.from<i.from+a.length)&&(n[i.from]=c,s.push({from:i.from,to:i.from+a.length,insert:h}))});return o.changes.empty||e(t.update(o,{userEvent:"indent"})),!0},vn=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(at(t,(n,r)=>{r.push({from:n.from,insert:t.facet(Ft)})}),{userEvent:"input.indent"})),!0),An=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(at(t,(n,r)=>{let o=/^\s*/.exec(n.text)[0];if(!o)return;let i=Ie(o,t.tabSize),s=0,l=J(t,Math.max(0,i-re(t)));for(;s<o.length&&s<l.length&&o.charCodeAt(s)==l.charCodeAt(s);)s++;r.push({from:n.from+s,to:n.from+o.length,insert:l.slice(s)})}),{userEvent:"delete.dedent"})),!0);var Ur=[{key:"Ctrl-b",run:Yt,shift:cn,preventDefault:!0},{key:"Ctrl-f",run:Zt,shift:an},{key:"Ctrl-p",run:nn,shift:fn},{key:"Ctrl-n",run:rn,shift:dn},{key:"Ctrl-a",run:cr,shift:Sr},{key:"Ctrl-e",run:ar,shift:br},{key:"Ctrl-d",run:gn},{key:"Ctrl-h",run:ot},{key:"Ctrl-k",run:kn},{key:"Ctrl-Alt-h",run:xn},{key:"Ctrl-o",run:Er},{key:"Ctrl-t",run:wr},{key:"Ctrl-v",run:rt}],qr=[{key:"ArrowLeft",run:Yt,shift:cn,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:Zn,shift:fr,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:sr,shift:xr,preventDefault:!0},{key:"ArrowRight",run:Zt,shift:an,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:er,shift:dr,preventDefault:!0},{mac:"Cmd-ArrowRight",run:lr,shift:kr,preventDefault:!0},{key:"ArrowUp",run:nn,shift:fn,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Nt,shift:zt},{mac:"Ctrl-ArrowUp",run:Vt,shift:Ut},{key:"ArrowDown",run:rn,shift:dn,preventDefault:!0},{mac:"Cmd-ArrowDown",run:_t,shift:Gt},{mac:"Ctrl-ArrowDown",run:rt,shift:qt},{key:"PageUp",run:Vt,shift:Ut},{key:"PageDown",run:rt,shift:qt},{key:"Home",run:ir,shift:yr,preventDefault:!0},{key:"Mod-Home",run:Nt,shift:zt},{key:"End",run:or,shift:gr,preventDefault:!0},{key:"Mod-End",run:_t,shift:Gt},{key:"Enter",run:Fr},{key:"Mod-a",run:Cr},{key:"Backspace",run:ot,shift:ot},{key:"Delete",run:gn},{key:"Mod-Backspace",mac:"Alt-Backspace",run:xn},{key:"Mod-Delete",mac:"Alt-Delete",run:Lr},{mac:"Mod-Backspace",run:Br},{mac:"Mod-Delete",run:kn}].concat(Ur.map(t=>({mac:t.key,run:t.run,shift:t.shift}))),ht=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:nr,shift:mr},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:rr,shift:pr},{key:"Alt-ArrowUp",run:Dr},{key:"Shift-Alt-ArrowUp",run:Tr},{key:"Alt-ArrowDown",run:Or},{key:"Shift-Alt-ArrowDown",run:Pr},{key:"Escape",run:Mr},{key:"Mod-Enter",run:Wr},{key:"Alt-l",mac:"Ctrl-l",run:vr},{key:"Mod-i",run:Ar,preventDefault:!0},{key:"Mod-[",run:An},{key:"Mod-]",run:vn},{key:"Mod-Alt-\\",run:Vr},{key:"Shift-Mod-k",run:Rr},{key:"Shift-Mod-\\",run:ur},{key:"Mod-/",run:In},{key:"Alt-A",run:Wn}].concat(qr),Mn={key:"Tab",run:vn,shift:An};B();E();B();E();function p(){var t=arguments[0];typeof t=="string"&&(t=document.createElement(t));var e=1,n=arguments[1];if(n&&typeof n=="object"&&n.nodeType==null&&!Array.isArray(n)){for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){var o=n[r];typeof o=="string"?t.setAttribute(r,o):o!=null&&(t[r]=o)}e++}for(;e<arguments.length;e++)Ln(t,arguments[e]);return t}function Ln(t,e){if(typeof e=="string")t.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)t.appendChild(e);else if(Array.isArray(e))for(var n=0;n<e.length;n++)Ln(t,e[n]);else throw new RangeError("Unsupported child node: "+e)}var Bn=typeof String.prototype.normalize=="function"?t=>t.normalize("NFKD"):t=>t,F=class{constructor(e,n,r=0,o=e.length,i,s){this.test=s,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(r,o),this.bufferStart=r,this.normalize=i?l=>i(Bn(l)):Bn,this.query=this.normalize(n)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return Bt(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let n=Et(e),r=this.bufferStart+this.bufferPos;this.bufferPos+=wt(e);let o=this.normalize(n);for(let i=0,s=r;;i++){let l=o.charCodeAt(i),c=this.match(l,s);if(c)return this.value=c,this;if(i==o.length-1)break;s==r&&i<n.length&&n.charCodeAt(i)==l&&s++}}}match(e,n){let r=null;for(let o=0;o<this.matches.length;o+=2){let i=this.matches[o],s=!1;this.query.charCodeAt(i)==e&&(i==this.query.length-1?r={from:this.matches[o+1],to:n+1}:(this.matches[o]++,s=!0)),s||(this.matches.splice(o,2),o-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?r={from:n,to:n+1}:this.matches.push(1,n)),r&&this.test&&!this.test(r.from,r.to,this.buffer,this.bufferPos)&&(r=null),r}};typeof Symbol!="undefined"&&(F.prototype[Symbol.iterator]=function(){return this});var On={from:-1,to:-1,match:/.*/.exec("")},yt="gm"+(/x/.unicode==null?"":"u"),Ce=class{constructor(e,n,r,o=0,i=e.length){if(this.text=e,this.to=i,this.curLine="",this.done=!1,this.value=On,/\\[sWDnr]|\n|\r|\[\^/.test(n))return new ve(e,n,r,o,i);this.re=new RegExp(n,yt+(r!=null&&r.ignoreCase?"i":"")),this.test=r==null?void 0:r.test,this.iter=e.iter();let s=e.lineAt(o);this.curLineStart=s.from,this.matchPos=Ae(e,o),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let n=this.matchPos<=this.to&&this.re.exec(this.curLine);if(n){let r=this.curLineStart+n.index,o=r+n[0].length;if(this.matchPos=Ae(this.text,o+(r==o?1:0)),r==this.curLineStart+this.curLine.length&&this.nextLine(),(r<o||r>this.value.to)&&(!this.test||this.test(r,o,n)))return this.value={from:r,to:o,match:n},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}},ut=new WeakMap,R=class{constructor(e,n){this.from=e,this.text=n}get to(){return this.from+this.text.length}static get(e,n,r){let o=ut.get(e);if(!o||o.from>=r||o.to<=n){let l=new R(n,e.sliceString(n,r));return ut.set(e,l),l}if(o.from==n&&o.to==r)return o;let{text:i,from:s}=o;return s>n&&(i=e.sliceString(n,s)+i,s=n),o.to<r&&(i+=e.sliceString(o.to,r)),ut.set(e,new R(s,i)),new R(n,i.slice(n-s,r-s))}},ve=class{constructor(e,n,r,o,i){this.text=e,this.to=i,this.done=!1,this.value=On,this.matchPos=Ae(e,o),this.re=new RegExp(n,yt+(r!=null&&r.ignoreCase?"i":"")),this.test=r==null?void 0:r.test,this.flat=R.get(e,o,this.chunkEnd(o+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,n=this.re.exec(this.flat.text);if(n&&!n[0]&&n.index==e&&(this.re.lastIndex=e+1,n=this.re.exec(this.flat.text)),n){let r=this.flat.from+n.index,o=r+n[0].length;if((this.flat.to>=this.to||n.index+n[0].length<=this.flat.text.length-10)&&(!this.test||this.test(r,o,n)))return this.value={from:r,to:o,match:n},this.matchPos=Ae(this.text,o+(r==o?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=R.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}};typeof Symbol!="undefined"&&(Ce.prototype[Symbol.iterator]=ve.prototype[Symbol.iterator]=function(){return this});function Nr(t){try{return new RegExp(t,yt),!0}catch(e){return!1}}function Ae(t,e){if(e>=t.length)return e;let n=t.lineAt(e),r;for(;e<n.to&&(r=n.text.charCodeAt(e-n.from))>=56320&&r<57344;)e++;return e}function ft(t){let e=p("input",{class:"cm-textfield",name:"line"}),n=p("form",{class:"cm-gotoLine",onkeydown:o=>{o.keyCode==27?(o.preventDefault(),t.dispatch({effects:Me.of(!1)}),t.focus()):o.keyCode==13&&(o.preventDefault(),r())},onsubmit:o=>{o.preventDefault(),r()}},p("label",t.state.phrase("Go to line"),": ",e)," ",p("button",{class:"cm-button",type:"submit"},t.state.phrase("go")));function r(){let o=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!o)return;let{state:i}=t,s=i.doc.lineAt(i.selection.main.head),[,l,c,a,h]=o,f=a?+a.slice(1):0,d=c?+c:s.number;if(c&&h){let D=d/100;l&&(D=D*(l=="-"?-1:1)+s.number/i.doc.lines),d=Math.round(i.doc.lines*D)}else c&&l&&(d=d*(l=="-"?-1:1)+s.number);let W=i.doc.line(Math.max(1,Math.min(i.doc.lines,d)));t.dispatch({effects:Me.of(!1),selection:u.cursor(W.from+Math.max(0,Math.min(f,W.length))),scrollIntoView:!0}),t.focus()}return{dom:n}}var Me=T.define(),En=G.define({create(){return!0},update(t,e){for(let n of e.effects)n.is(Me)&&(t=n.value);return t},provide:t=>Ne.from(t,e=>e?ft:null)}),_r=t=>{let e=$(t,ft);if(!e){let n=[Me.of(!0)];t.state.field(En,!1)==null&&n.push(T.appendConfig.of([En,zr])),t.dispatch({effects:n}),e=$(t,ft)}return e&&e.dom.querySelector("input").focus(),!0},zr=m.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),Gr={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},Tn=q.define({combine(t){return K(t,Gr,{highlightWordAroundCursor:(e,n)=>e||n,minSelectionLength:Math.min,maxMatches:Math.min})}});function xt(t){let e=[jr,Hr];return t&&e.push(Tn.of(t)),e}var Kr=k.mark({class:"cm-selectionMatch"}),$r=k.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function wn(t,e,n,r){return(n==0||t(e.sliceDoc(n-1,n))!=x.Word)&&(r==e.doc.length||t(e.sliceDoc(r,r+1))!=x.Word)}function Jr(t,e,n,r){return t(e.sliceDoc(n,n+1))==x.Word&&t(e.sliceDoc(r-1,r))==x.Word}var Hr=Fe.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.selectionSet||t.docChanged||t.viewportChanged)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=t.state.facet(Tn),{state:n}=t,r=n.selection;if(r.ranges.length>1)return k.none;let o=r.main,i,s=null;if(o.empty){if(!e.highlightWordAroundCursor)return k.none;let c=n.wordAt(o.head);if(!c)return k.none;s=n.charCategorizer(o.head),i=n.sliceDoc(c.from,c.to)}else{let c=o.to-o.from;if(c<e.minSelectionLength||c>200)return k.none;if(e.wholeWords){if(i=n.sliceDoc(o.from,o.to),s=n.charCategorizer(o.head),!(wn(s,n,o.from,o.to)&&Jr(s,n,o.from,o.to)))return k.none}else if(i=n.sliceDoc(o.from,o.to).trim(),!i)return k.none}let l=[];for(let c of t.visibleRanges){let a=new F(n.doc,i,c.from,c.to);for(;!a.next().done;){let{from:h,to:f}=a.value;if((!s||wn(s,n,h,f))&&(o.empty&&h<=o.from&&f>=o.to?l.push($r.range(h,f)):(h>=o.to||f<=o.from)&&l.push(Kr.range(h,f)),l.length>e.maxMatches))return k.none}}return k.set(l)}},{decorations:t=>t.decorations}),jr=m.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),Qr=({state:t,dispatch:e})=>{let{selection:n}=t,r=u.create(n.ranges.map(o=>t.wordAt(o.head)||u.cursor(o.head)),n.mainIndex);return r.eq(n)?!1:(e(t.update({selection:r})),!0)};function Xr(t,e){let{main:n,ranges:r}=t.selection,o=t.wordAt(n.head),i=o&&o.from==n.from&&o.to==n.to;for(let s=!1,l=new F(t.doc,e,r[r.length-1].to);;)if(l.next(),l.done){if(s)return null;l=new F(t.doc,e,0,Math.max(0,r[r.length-1].from-1)),s=!0}else{if(s&&r.some(c=>c.from==l.value.from))continue;if(i){let c=t.wordAt(l.value.from);if(!c||c.from!=l.value.from||c.to!=l.value.to)continue}return l.value}}var Yr=({state:t,dispatch:e})=>{let{ranges:n}=t.selection;if(n.some(i=>i.from===i.to))return Qr({state:t,dispatch:e});let r=t.sliceDoc(n[0].from,n[0].to);if(t.selection.ranges.some(i=>t.sliceDoc(i.from,i.to)!=r))return!1;let o=Xr(t,r);return o?(e(t.update({selection:t.selection.addRange(u.range(o.from,o.to),!1),effects:m.scrollIntoView(o.to)})),!0):!1},kt=q.define({combine(t){return K(t,{top:!1,caseSensitive:!1,literal:!1,wholeWord:!1,createPanel:e=>new gt(e)})}});var Le=class{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||Nr(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(n,r)=>r=="n"?`
`:r=="r"?"\r":r=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new mt(this):new dt(this)}getCursor(e,n=0,r){let o=e.doc?e:ee.create({doc:e});return r==null&&(r=o.doc.length),this.regexp?z(this,o,n,r):_(this,o,n,r)}},Be=class{constructor(e){this.spec=e}};function _(t,e,n,r){return new F(e.doc,t.unquoted,n,r,t.caseSensitive?void 0:o=>o.toLowerCase(),t.wholeWord?Zr(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function Zr(t,e){return(n,r,o,i)=>((i>n||i+o.length<r)&&(i=Math.max(0,n-2),o=t.sliceString(i,Math.min(t.length,r+2))),(e(Ee(o,n-i))!=x.Word||e(we(o,n-i))!=x.Word)&&(e(we(o,r-i))!=x.Word||e(Ee(o,r-i))!=x.Word))}var dt=class extends Be{constructor(e){super(e)}nextMatch(e,n,r){let o=_(this.spec,e,r,e.doc.length).nextOverlapping();return o.done&&(o=_(this.spec,e,0,n).nextOverlapping()),o.done?null:o.value}prevMatchInRange(e,n,r){for(let o=r;;){let i=Math.max(n,o-1e4-this.spec.unquoted.length),s=_(this.spec,e,i,o),l=null;for(;!s.nextOverlapping().done;)l=s.value;if(l)return l;if(i==n)return null;o-=1e4}}prevMatch(e,n,r){return this.prevMatchInRange(e,0,n)||this.prevMatchInRange(e,r,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,n){let r=_(this.spec,e,0,e.doc.length),o=[];for(;!r.next().done;){if(o.length>=n)return null;o.push(r.value)}return o}highlight(e,n,r,o){let i=_(this.spec,e,Math.max(0,n-this.spec.unquoted.length),Math.min(r+this.spec.unquoted.length,e.doc.length));for(;!i.next().done;)o(i.value.from,i.value.to)}};function z(t,e,n,r){return new Ce(e.doc,t.search,{ignoreCase:!t.caseSensitive,test:t.wholeWord?eo(e.charCategorizer(e.selection.main.head)):void 0},n,r)}function Ee(t,e){return t.slice(O(t,e,!1),e)}function we(t,e){return t.slice(e,O(t,e))}function eo(t){return(e,n,r)=>!r[0].length||(t(Ee(r.input,r.index))!=x.Word||t(we(r.input,r.index))!=x.Word)&&(t(we(r.input,r.index+r[0].length))!=x.Word||t(Ee(r.input,r.index+r[0].length))!=x.Word)}var mt=class extends Be{nextMatch(e,n,r){let o=z(this.spec,e,r,e.doc.length).next();return o.done&&(o=z(this.spec,e,0,n).next()),o.done?null:o.value}prevMatchInRange(e,n,r){for(let o=1;;o++){let i=Math.max(n,r-o*1e4),s=z(this.spec,e,i,r),l=null;for(;!s.next().done;)l=s.value;if(l&&(i==n||l.from>i+10))return l;if(i==n)return null}}prevMatch(e,n,r){return this.prevMatchInRange(e,0,n)||this.prevMatchInRange(e,r,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace.replace(/\$([$&\d+])/g,(n,r)=>r=="$"?"$":r=="&"?e.match[0]:r!="0"&&+r<e.match.length?e.match[r]:n))}matchAll(e,n){let r=z(this.spec,e,0,e.doc.length),o=[];for(;!r.next().done;){if(o.length>=n)return null;o.push(r.value)}return o}highlight(e,n,r,o){let i=z(this.spec,e,Math.max(0,n-250),Math.min(r+250,e.doc.length));for(;!i.next().done;)o(i.value.from,i.value.to)}},Q=T.define(),St=T.define(),I=G.define({create(t){return new j(pt(t).create(),null)},update(t,e){for(let n of e.effects)n.is(Q)?t=new j(n.value.create(),t.panel):n.is(St)&&(t=new j(t.query,n.value?bt:null));return t},provide:t=>Ne.from(t,e=>e.panel)});var j=class{constructor(e,n){this.query=e,this.panel=n}},to=k.mark({class:"cm-searchMatch"}),no=k.mark({class:"cm-searchMatch cm-searchMatch-selected"}),ro=Fe.fromClass(class{constructor(t){this.view=t,this.decorations=this.highlight(t.state.field(I))}update(t){let e=t.state.field(I);(e!=t.startState.field(I)||t.docChanged||t.selectionSet||t.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:t,panel:e}){if(!e||!t.spec.valid)return k.none;let{view:n}=this,r=new Pt;for(let o=0,i=n.visibleRanges,s=i.length;o<s;o++){let{from:l,to:c}=i[o];for(;o<s-1&&c>i[o+1].from-2*250;)c=i[++o].to;t.highlight(n.state,l,c,(a,h)=>{let f=n.state.selection.ranges.some(d=>d.from==a&&d.to==h);r.add(a,h,f?no:to)})}return r.finish()}},{decorations:t=>t.decorations});function X(t){return e=>{let n=e.state.field(I,!1);return n&&n.query.spec.valid?t(e,n):Pn(e)}}var De=X((t,{query:e})=>{let{to:n}=t.state.selection.main,r=e.nextMatch(t.state,n,n);return r?(t.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0,effects:vt(t,r),userEvent:"select.search"}),!0):!1}),Oe=X((t,{query:e})=>{let{state:n}=t,{from:r}=n.selection.main,o=e.prevMatch(n,r,r);return o?(t.dispatch({selection:{anchor:o.from,head:o.to},scrollIntoView:!0,effects:vt(t,o),userEvent:"select.search"}),!0):!1}),oo=X((t,{query:e})=>{let n=e.matchAll(t.state,1e3);return!n||!n.length?!1:(t.dispatch({selection:u.create(n.map(r=>u.range(r.from,r.to))),userEvent:"select.search.matches"}),!0)}),io=({state:t,dispatch:e})=>{let n=t.selection;if(n.ranges.length>1||n.main.empty)return!1;let{from:r,to:o}=n.main,i=[],s=0;for(let l=new F(t.doc,t.sliceDoc(r,o));!l.next().done;){if(i.length>1e3)return!1;l.value.from==r&&(s=i.length),i.push(u.range(l.value.from,l.value.to))}return e(t.update({selection:u.create(i,s),userEvent:"select.search.matches"})),!0},Dn=X((t,{query:e})=>{let{state:n}=t,{from:r,to:o}=n.selection.main;if(n.readOnly)return!1;let i=e.nextMatch(n,r,r);if(!i)return!1;let s=[],l,c,a=[];if(i.from==r&&i.to==o&&(c=n.toText(e.getReplacement(i)),s.push({from:i.from,to:i.to,insert:c}),i=e.nextMatch(n,i.from,i.to),a.push(m.announce.of(n.phrase("replaced match on line $",n.doc.lineAt(r).number)+"."))),i){let h=s.length==0||s[0].from>=i.to?0:i.to-i.from-c.length;l={anchor:i.from-h,head:i.to-h},a.push(vt(t,i))}return t.dispatch({changes:s,selection:l,scrollIntoView:!!l,effects:a,userEvent:"input.replace"}),!0}),so=X((t,{query:e})=>{if(t.state.readOnly)return!1;let n=e.matchAll(t.state,1e9).map(o=>{let{from:i,to:s}=o;return{from:i,to:s,insert:e.getReplacement(o)}});if(!n.length)return!1;let r=t.state.phrase("replaced $ matches",n.length)+".";return t.dispatch({changes:n,effects:m.announce.of(r),userEvent:"input.replace.all"}),!0});function bt(t){return t.state.facet(kt).createPanel(t)}function pt(t,e){var n,r,o,i;let s=t.selection.main,l=s.empty||s.to>s.from+100?"":t.sliceDoc(s.from,s.to);if(e&&!l)return e;let c=t.facet(kt);return new Le({search:((n=e==null?void 0:e.literal)!==null&&n!==void 0?n:c.literal)?l:l.replace(/\n/g,"\\n"),caseSensitive:(r=e==null?void 0:e.caseSensitive)!==null&&r!==void 0?r:c.caseSensitive,literal:(o=e==null?void 0:e.literal)!==null&&o!==void 0?o:c.literal,wholeWord:(i=e==null?void 0:e.wholeWord)!==null&&i!==void 0?i:c.wholeWord})}var Pn=t=>{let e=t.state.field(I,!1);if(e&&e.panel){let n=$(t,bt);if(!n)return!1;let r=n.dom.querySelector("[main-field]");if(r&&r!=t.root.activeElement){let o=pt(t.state,e.query.spec);o.valid&&t.dispatch({effects:Q.of(o)}),r.focus(),r.select()}}else t.dispatch({effects:[St.of(!0),e?Q.of(pt(t.state,e.query.spec)):T.appendConfig.of(co)]});return!0},Rn=t=>{let e=t.state.field(I,!1);if(!e||!e.panel)return!1;let n=$(t,bt);return n&&n.dom.contains(t.root.activeElement)&&t.focus(),t.dispatch({effects:St.of(!1)}),!0},Ct=[{key:"Mod-f",run:Pn,scope:"editor search-panel"},{key:"F3",run:De,shift:Oe,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:De,shift:Oe,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:Rn,scope:"editor search-panel"},{key:"Mod-Shift-l",run:io},{key:"Alt-g",run:_r},{key:"Mod-d",run:Yr,preventDefault:!0}],gt=class{constructor(e){this.view=e;let n=this.query=e.state.field(I).query.spec;this.commit=this.commit.bind(this),this.searchField=p("input",{value:n.search,placeholder:S(e,"Find"),"aria-label":S(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=p("input",{value:n.replace,placeholder:S(e,"Replace"),"aria-label":S(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=p("input",{type:"checkbox",name:"case",form:"",checked:n.caseSensitive,onchange:this.commit}),this.reField=p("input",{type:"checkbox",name:"re",form:"",checked:n.regexp,onchange:this.commit}),this.wordField=p("input",{type:"checkbox",name:"word",form:"",checked:n.wholeWord,onchange:this.commit});function r(o,i,s){return p("button",{class:"cm-button",name:o,onclick:i,type:"button"},s)}this.dom=p("div",{onkeydown:o=>this.keydown(o),class:"cm-search"},[this.searchField,r("next",()=>De(e),[S(e,"next")]),r("prev",()=>Oe(e),[S(e,"previous")]),r("select",()=>oo(e),[S(e,"all")]),p("label",null,[this.caseField,S(e,"match case")]),p("label",null,[this.reField,S(e,"regexp")]),p("label",null,[this.wordField,S(e,"by word")]),...e.state.readOnly?[]:[p("br"),this.replaceField,r("replace",()=>Dn(e),[S(e,"replace")]),r("replaceAll",()=>so(e),[S(e,"replace all")]),p("button",{name:"close",onclick:()=>Rn(e),"aria-label":S(e,"close"),type:"button"},["\xD7"])]])}commit(){let e=new Le({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:Q.of(e)}))}keydown(e){It(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?Oe:De)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),Dn(this.view))}update(e){for(let n of e.transactions)for(let r of n.effects)r.is(Q)&&!r.value.eq(this.query)&&this.setQuery(r.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(kt).top}};function S(t,e){return t.state.phrase(e)}var Se=30,be=/[\s\.,:;?!]/;function vt(t,{from:e,to:n}){let r=t.state.doc.lineAt(e),o=t.state.doc.lineAt(n).to,i=Math.max(r.from,e-Se),s=Math.min(o,n+Se),l=t.state.sliceDoc(i,s);if(i!=r.from){for(let c=0;c<Se;c++)if(!be.test(l[c+1])&&be.test(l[c])){l=l.slice(c);break}}if(s!=o){for(let c=l.length-1;c>l.length-Se;c--)if(!be.test(l[c-1])&&be.test(l[c])){l=l.slice(0,c);break}}return m.announce.of(`${t.state.phrase("current match")}. ${l} ${t.state.phrase("on line")} ${r.number}.`)}var lo=m.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),co=[I,Tt.lowest(ro),lo];B();E();var A=class extends Lt{constructor(){super(...arguments);this.extensions=()=>[];this.transformSource=n=>n;this.readonlyOrDisabled=new Pe;this.userExtensions=new Pe}static get styles(){return[At`
        ::slotted(*) {
          display: none;
        }

        :host[disabled] {
          pointer-events: none;
        }

       /*.cm-editor {
          background: var(--code-editor-background-color);
          font-size: 16px;
          padding: 12px;
          max-height: var(--code-editor-max-height);
          max-width: var(--code-editor-max-width);
          min-height: var(--code-editor-min-height);
          min-width: var(--code-editor-min-width);
        }*/

        .cm-content {
          white-space: pre-wrap !important;
        }

        .copy-code-wrap {
          position: absolute;
          bottom: 5px;
          right: 5px;
          z-index: 10;
          cursor: pointer;
        }

        .copy-code {
          height: 16px;
          width: 16px;
          position: relative;
          bottom: 0px;
          right: 0px;
          opacity: 50%;
          border-radius: 50%;
          z-index: 10;
          transition: all 0.2s ease 0s;
          color: white;
          font-size: xx-small;
        }

        .copy-icon {
            font-size: 16px; 
            cursor: pointer; 
            margin-left: 12px;
            opacity: 50%;
        }

        .copy-icon:hover,
        .copy-code:hover {
          opacity: 100%;
        }

        .copy-code-wrap:active .copy-icon,
        .copy-code-wrap:active .copy-code {
          transform: translate(0, 0) scale(0.9);
        }
        
        /*.cm-scroller::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        .cm-scroller::-webkit-scrollbar-track {
            box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            background-color: lightgrey;
        }
        
        .cm-scroller::-webkit-scrollbar-thumb {
            box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            background-color:  darkgrey;
        
            border-top: 1px solid transparent;
            border-bottom: 1px solid transparent;
            border-left: 1px solid transparent;
            border-right: 1px solid transparent;
        
            background-clip: padding-box;
        }*/
      `]}async refresh(n=void 0){if(n&&(this.code=await n()),!this.disabled&&this.editor&&(this.code||this.slotElement.assignedNodes().length>0)){let r=this.code?await this.transformSource(await this.code):await this.transformSource(this._readCode(this.slotElement));this.editor.dispatch({changes:{from:0,to:this.editor.state.doc.length,insert:r}})}}async updateExtensions(){!this.editor||this.editor.dispatch({effects:this.userExtensions.reconfigure([this.readOnly||this.disabled?[]:[_e(),Ve(),lt(),We(),Ke(),He(),je(),Xe(),Ue(),te.of([...Qe,...ht,...Ct,...ct,...Ye])],$e(Je,{fallback:!0}),qe(),xt(),await this.extensions()])})}render(){return Mt`
      <div style="position: relative">
        <!-- button to copy the editor -->
        <div class="copy-code-wrap" @click="${()=>this._copyCode()}">
          <omni-icon class="copy-icon" icon="@material/content_copy" size="${"custom"}"></omni-icon>
        </div>
        <!-- CodeMirror Editor parent element -->
        <div class="code-parent"> </div>
      </div>
      <slot @slotchange="${()=>this._slotChanged()}"></slot>
    `}async updated(n){var r,o,i,s,l,c;if(!this.editor&&this.codeParent&&(this.code||this.slotElement.assignedNodes().length>0)){let a=this.code?await this.transformSource(await this.code):await this.transformSource(this._readCode(this.slotElement));this._clearElements(this.codeParent),this.editor=new m({doc:a,extensions:[this.userExtensions.of([this.readOnly||this.disabled?[]:[_e(),Ve(),lt(),We(),Ke(),He(),je(),Xe(),Ue(),te.of([...Qe,...ht,...Ct,...ct,...Ye])],$e(Je,{fallback:!0}),qe(),xt(),await this.extensions()]),this.readonlyOrDisabled.of([ee.readOnly.of(this.readOnly||this.disabled),m.editable.of(!this.readOnly&&!this.disabled)]),te.of(this.noTab?[]:[Mn]),m.updateListener.of(async h=>{if(h.docChanged){let f=a;a=this.editor.state.doc.toString(),this.code=a,this.requestUpdate(),await this.updateComplete,this.disabled||(this.dispatchEvent(new CustomEvent("codemirror-update",{detail:{update:h,editor:this.editor,source:this.editor.state.doc.toString()}})),this.dispatchEvent(new CustomEvent("codemirror-source-change",{detail:{update:h,editor:this.editor,oldSource:f,source:a}})))}else this.disabled||this.dispatchEvent(new CustomEvent("codemirror-update",{detail:{update:h,editor:this.editor,source:this.editor.state.doc.toString()}}))})],parent:this.codeParent}),this._clearOtherElements(this.codeParent,this.editor.dom),(o=(r=this.editor.dom)==null?void 0:r.part)==null||o.add("editor"),(s=(i=this.editor.scrollDOM)==null?void 0:i.part)==null||s.add("editor-scroller"),(c=(l=this.editor.contentDOM)==null?void 0:l.part)==null||c.add("editor-content"),this.disabled||this.dispatchEvent(new CustomEvent("codemirror-loaded",{detail:{editor:this.editor,source:this.editor.state.doc.toString()}}))}}async _copyCode(){this._copyTextToClipboard(await this.code)}_fallbackCopyTextToClipboard(n){let r=document.createElement("textarea");r.value=n,r.style.top="0",r.style.left="0",r.style.position="fixed",document.body.appendChild(r),r.focus(),r.select();try{document.execCommand("copy")}catch(o){console.error(o)}document.body.removeChild(r)}_copyTextToClipboard(n){if(!navigator.clipboard){this._fallbackCopyTextToClipboard(n);return}navigator.clipboard.writeText(n).then(void 0,r=>{console.error("Attempting fallback, could not copy text: ",r),this._fallbackCopyTextToClipboard(n)})}async _slotChanged(){if(!this.editor)return;let n=this.code?await this.transformSource(await this.code):await this.transformSource(this._readCode(this.slotElement));!this.disabled&&n!==this.editor.state.doc.toString()&&this.editor.dispatch({changes:{from:0,to:this.editor.state.doc.length,insert:n}})}_readCode(n){return n.assignedNodes().map(o=>o instanceof Element?o.outerHTML:o.textContent).join(`\r
`)}_clearElements(n=void 0){n||(n=this.renderRoot);let r=n.lastElementChild;for(;r;){let o=r;r=r.previousElementSibling,o.hasAttribute("slot")||n.removeChild(o)}}_clearOtherElements(n=void 0,r){if(n||(n=this.renderRoot),!r||!n.contains(r)){this._clearElements(n);return}let o=n.children.length;if(o>1)for(let i=o-1;i>=0;i--){let s=n.children[i];!s.hasAttribute("slot")&&s!==r&&n.removeChild(s)}}};L([U({type:Object,reflect:!1})],A.prototype,"extensions",2),L([U({type:Object,reflect:!1})],A.prototype,"transformSource",2),L([U({type:String,reflect:!0})],A.prototype,"code",2),L([U({type:Boolean,attribute:"read-only",reflect:!0})],A.prototype,"readOnly",2),L([U({type:Boolean,reflect:!0})],A.prototype,"disabled",2),L([U({type:Boolean,attribute:"no-tab",reflect:!0})],A.prototype,"noTab",2),L([Ze(".code-parent")],A.prototype,"codeParent",2),L([Ze("slot")],A.prototype,"slotElement",2),A=L([Wt("code-editor")],A);export{A as a};
//# sourceMappingURL=chunk.LVNHDGJ7.js.map
